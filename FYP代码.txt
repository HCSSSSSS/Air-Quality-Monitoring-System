										FYPé¡¹ç›®
https://sam.csc.liv.ac.uk/ELEC340/2024/projects/all
										Arduino å‘é€æ•°æ®

void setup() {
Â  Serial.begin(115200);
}

void loop() {
Â  Serial.println("Hello from Arduino"); // æ¯ç§’å‘é€ä¸€æ¬¡
Â  delay(1000);
}

										æ‰“å¼€æœåŠ¡å™¨ï¼ˆç»ˆç«¯ï¼‰

cd C:\Users\Chaos\air-quality-server
node server.js

										
										è¿è¡Œvueå‰ç«¯é¡¹ç›®
cd air-quality-frontend
npm run serve

										è¿è¡Œæ¨ç‰¹å‘é€
cd C:\Users\Chaos\air-quality-server
python tweet_sensor.py

										ESP32æ‰“å¼€ç½‘é¡µ

#include <WiFi.h>
#include <HTTPClient.h>

const char* ssid = "HCSS"; Â  Â  Â  Â  // ä½ çš„ WiFi åç§°
const char* password = "123456789"; // ä½ çš„ WiFi å¯†ç 
const char* serverUrl = "http://192.168.137.1:3000/upload";

// **å‡½æ•°å£°æ˜**
void sendToServer(String message);

void setup() {
Â  Â  Serial.begin(115200);
Â  Â  WiFi.begin(ssid, password);

Â  Â  while (WiFi.status() != WL_CONNECTED) {
Â  Â  Â  Â  delay(500);
Â  Â  Â  Â  Serial.print(".");
Â  Â  }
Â  Â  Serial.println("\nâœ… WiFi Connected!");
Â  Â  Serial.print("ğŸ“¡ IP Address: ");
Â  Â  Serial.println(WiFi.localIP());
}

void loop() {
Â  Â  sendToServer("Hello from Arduino");
Â  Â  delay(5000); Â // æ¯ 5 ç§’å‘é€ä¸€æ¬¡
}

// **å®šä¹‰ sendToServer()**
void sendToServer(String message) {
Â  Â  if (WiFi.status() == WL_CONNECTED) {
Â  Â  Â  Â  HTTPClient http;
Â  Â  Â  Â  http.begin(serverUrl);
Â  Â  Â  Â  http.addHeader("Content-Type", "application/json");

Â  Â  Â  Â  // ç”Ÿæˆ JSON æ•°æ®
Â  Â  Â  Â  String jsonData = "{\"message\":\"" + message + "\"}";
Â  Â  Â  Â  Serial.print("ğŸ“¤ Sending JSON: ");
Â  Â  Â  Â  Serial.println(jsonData);

Â  Â  Â  Â  int httpResponseCode = http.POST(jsonData);
Â  Â  Â  Â  Serial.print("ğŸ“¡ HTTP Response Code: ");
Â  Â  Â  Â  Serial.println(httpResponseCode);

Â  Â  Â  Â  http.end();
Â  Â  } else {
Â  Â  Â  Â  Serial.println("âŒ WiFi not connected!");
Â  Â  }
}


									vue sensor dataä»£ç 

<template>
    <div class="container">
      <h1>å®æ—¶ä¼ æ„Ÿå™¨æ•°æ®</h1>
      <div v-if="dataLoaded" class="data-card">
        <div class="data-item">ğŸŒ¡ï¸ æ¸©åº¦: <span>{{ sensorData.temperature ?? '--' }}Â°C</span></div>
        <div class="data-item">ğŸ’§ æ¹¿åº¦: <span>{{ sensorData.humidity ?? '--' }}%</span></div>
        <div class="data-item">âš ï¸ CO æµ“åº¦: <span>{{ sensorData.arduino?.CO ?? '--' }} ppm</span></div>
        <div class="data-item">â˜ï¸ NOâ‚‚ æµ“åº¦: <span>{{ sensorData.arduino?.NO2 ?? '--' }} ppm</span></div>
        <div class="data-item">ğŸŒ«ï¸ NHâ‚ƒ æµ“åº¦: <span>{{ sensorData.arduino?.NH3 ?? '--' }} ppm</span></div>
        <div class="timestamp">ğŸ•’ æœ€åæ›´æ–°: <span>{{ sensorData.timestamp ?? '--' }}</span></div>
      </div>
      <div v-else class="loading">ğŸ“¡ æ­£åœ¨åŠ è½½æ•°æ®...</div>
    </div>
  </template>
  
  <script>
  import axios from 'axios';
  
  export default {
    data() {
      return {
        sensorData: {},
        dataLoaded: false
      };
    },
    methods: {
      async fetchData() {
        try {
          const response = await axios.get("http://localhost:3000/data");
          this.sensorData = response.data;
          this.dataLoaded = true;
        } catch (error) {
          console.error("âŒ è·å–æ•°æ®å¤±è´¥:", error);
        }
      }
    },
    mounted() {
      this.fetchData(); // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
      setInterval(this.fetchData, 5000); // æ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡æ•°æ®
    }
  };
  </script>
  
  <style scoped>
  .container {
    font-family: Arial, sans-serif;
    max-width: 500px;
    margin: 20px auto;
    text-align: center;
  }
  .data-card {
    background: #f5f5f5;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  .data-item {
    font-size: 18px;
    margin: 10px 0;
  }
  .timestamp {
    color: #666;
    font-size: 14px;
  }
  .loading {
    font-size: 18px;
    color: blue;
  }
  </style>
   
                                                    				vue Homeview ä»£ç 
<template>
  <div>
    <SensorData />
  </div>
</template>

<script>
import SensorData from '@/components/SensorData.vue';

export default {
  components: {
    SensorData
  }
};
</script>

                                                                            ESP32æœåŠ¡å™¨æµ‹è¯•ä»£ç 

#include <WiFi.h>
#include <HTTPClient.h>

const char* ssid = "HCSS";         // ä½ çš„ WiFi åç§°
const char* password = "123456789"; // ä½ çš„ WiFi å¯†ç 
const char* serverUrl = "http://192.168.137.1:3000/upload";

// **å‡½æ•°å£°æ˜**
void sendToServer(String message);

void setup() {
    Serial.begin(115200);
    WiFi.begin(ssid, password);
  
    Serial.print("ğŸ”„ è¿æ¥ WiFi");
    while (WiFi.status() != WL_CONNECTED) {
      delay(500);
      Serial.print(".");
    }
    Serial.println("\nâœ… WiFi è¿æ¥æˆåŠŸ!");
    Serial.print("ğŸ“¡ IP åœ°å€: ");
    Serial.println(WiFi.localIP());
  }
  
  void loop() {
    if (WiFi.status() == WL_CONNECTED) {
      HTTPClient http;
      http.begin(serverUrl);
      http.addHeader("Content-Type", "application/json");
  
      // æ„é€  JSON æ•°æ®ï¼ˆæ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®ï¼‰
      String jsonPayload = "{"
                            "\"temperature\": 22.5,"
                            "\"humidity\": 60,"
                            "\"arduino\": {"
                            "\"CO\": 0.3,"
                            "\"NO2\": 0.5,"
                            "\"NH3\": 0.1"
                            "},"
                            "\"timestamp\": \"" + String(millis()) + "\""
                            "}";
  
      Serial.print("ğŸ“¤ å‘é€ JSON: ");
      Serial.println(jsonPayload);
  
      int httpResponseCode = http.POST(jsonPayload);
  
      Serial.print("ğŸ”„ HTTP å“åº”ç : ");
      Serial.println(httpResponseCode);
  
      http.end();
    } else {
      Serial.println("âš ï¸ WiFi æœªè¿æ¥!");
    }
  
    delay(2000); // æ¯ 2 ç§’å‘é€ä¸€æ¬¡æ•°æ®
  }

                                                                      Arduino MQ2,MICS-6814ï¼ŒMH-Z19Bä»£ç 

#include <SoftwareSerial.h>
#include <MHZ19.h>

// ä¼ æ„Ÿå™¨å¼•è„šå®šä¹‰
#define MQ2_PIN A0      // MQ-2 ä¼ æ„Ÿå™¨æ¨¡æ‹Ÿå¼•è„šï¼ˆå¯ç‡ƒæ°”ä½“ï¼‰
#define CO_PIN A1       // MICS-6814 CO (ä¸€æ°§åŒ–ç¢³)
#define NO2_PIN A2      // MICS-6814 NOâ‚‚ (äºŒæ°§åŒ–æ°®)
#define NH3_PIN A3      // MICS-6814 NHâ‚ƒ (æ°¨æ°”)

// MH-Z19B COâ‚‚ ä¼ æ„Ÿå™¨å¼•è„š
#define RX_PIN 10       // Arduino RX (æ¥ MH-Z19 TX)
#define TX_PIN 11       // Arduino TX (æ¥ MH-Z19 RX)

// è½¯ä»¶ä¸²å£ & MH-Z19B ä¼ æ„Ÿå™¨
SoftwareSerial mySerial(RX_PIN, TX_PIN);
MHZ19 myMHZ19;

void setup() {
    Serial.begin(115200);      // PC ä¸²å£ç›‘è§†å™¨
    mySerial.begin(9600);      // MH-Z19 ä¸²å£
    myMHZ19.begin(mySerial);   // åˆå§‹åŒ– MH-Z19B

    Serial.println("Arduino ä¼ æ„Ÿå™¨æµ‹è¯•ç¨‹åºå¯åŠ¨...");
    delay(3000); // ç­‰å¾…ä¼ æ„Ÿå™¨ç¨³å®š
}

void loop() {
    // è¯»å– MQ-2 å¯ç‡ƒæ°”ä½“ä¼ æ„Ÿå™¨
    int mq2Value = analogRead(MQ2_PIN);
    
    // è¯»å– MICS-6814 å¤šæ°”ä½“ä¼ æ„Ÿå™¨
    int coValue = analogRead(CO_PIN);
    int no2Value = analogRead(NO2_PIN);
    int nh3Value = analogRead(NH3_PIN);

    // è¯»å– MH-Z19B COâ‚‚ ä¼ æ„Ÿå™¨
    int co2ppm = myMHZ19.getCO2();

    // ä¸²å£æ‰“å°è¾“å‡ºæ•°æ®
    Serial.println("====================================");
    Serial.print("å¯ç‡ƒæ°”ä½“ (MQ-2): ");
    Serial.println(mq2Value);
    
    Serial.print("CO (MICS-6814): ");
    Serial.println(coValue);

    Serial.print("NOâ‚‚ (MICS-6814): ");
    Serial.println(no2Value);

    Serial.print("NHâ‚ƒ (MICS-6814): ");
    Serial.println(nh3Value);

    Serial.print("COâ‚‚ (MH-Z19B): ");
    Serial.print(co2ppm);
    Serial.println(" ppm");

    Serial.println("====================================");

    // æ¯ 10 ç§’æ›´æ–°ä¸€æ¬¡
    delay(10000);
}
									ESP32 SDS011
#include <Arduino.h>
#include <SdsDustSensor.h>

// âœ… ç¡¬ä»¶ä¸²å£å®šä¹‰ (ä½¿ç”¨ ESP32 çš„ RX3 / TX3)
#define SDS011_RX 25  // è¿æ¥ SDS011 TX
#define SDS011_TX 26  // è¿æ¥ SDS011 RX

// âœ… åˆ›å»º SDS011 ä¼ æ„Ÿå™¨å¯¹è±¡ (ä½¿ç”¨ç¡¬ä»¶ä¸²å£)
HardwareSerial mySerial(2); // UART2 (RX=GPIO25, TX=GPIO26)
SdsDustSensor sds011(mySerial);

void setup() {
    Serial.begin(115200);
    Serial.println("ğŸ”„ æ­£åœ¨åˆå§‹åŒ– SDS011 ä¼ æ„Ÿå™¨...");

    // âœ… å¯åŠ¨ä¸²å£é€šä¿¡
    mySerial.begin(9600, SERIAL_8N1, SDS011_RX, SDS011_TX);

    // âœ… è®¾ç½®æŸ¥è¯¢æ¨¡å¼ (é»˜è®¤æ˜¯è¿ç»­è¾“å‡ºæ¨¡å¼)
    sds011.setActiveReportingMode();
    Serial.println("âœ… SDS011 åˆå§‹åŒ–å®Œæˆï¼");
}

void loop() {
    // è¯»å– PM2.5 å’Œ PM10 æ•°æ®
    PmResult pm = sds011.queryPm();
    if (pm.isOk()) {
        Serial.printf("ğŸŒ«ï¸ PM2.5: %.1f Âµg/mÂ³  |  ğŸŒª PM10: %.1f Âµg/mÂ³\n", pm.pm25, pm.pm10);
    } else {
        Serial.println("âš ï¸ è¯»å– SDS011 å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¿æ¥ï¼");
    }

    delay(10000); // 10ç§’è¯»å–ä¸€æ¬¡
}
									ESP32èœ‚é¸£å™¨å’ŒSDå¡
#include <Arduino.h>
#include <SPI.h>
#include <SD.h>

#define BUZZER_PIN 16  // èœ‚é¸£å™¨è¿æ¥çš„å¼•è„š

void setup() {
    pinMode(BUZZER_PIN, OUTPUT);
    Serial.begin(115200);
    Serial.println("èœ‚é¸£å™¨æµ‹è¯•å¼€å§‹...");
}

void loop() {
    Serial.println("èœ‚é¸£å™¨å“èµ·...");
    digitalWrite(BUZZER_PIN, HIGH);
    delay(1000);  // å“ 1 ç§’
    Serial.println("èœ‚é¸£å™¨å…³é—­...");
    digitalWrite(BUZZER_PIN, LOW);
    delay(1000);  // å…³é—­ 1 ç§’
}


#define SD_CS 5  // SD å¡çš„ CS ç‰‡é€‰å¼•è„š

void setup() {
    Serial.begin(115200);
    Serial.print("æ­£åœ¨åˆå§‹åŒ– SD å¡...");
    
    if (!SD.begin(SD_CS)) {
        Serial.println("SD å¡åˆå§‹åŒ–å¤±è´¥ï¼");
        return;
    }
    
    Serial.println("SD å¡åˆå§‹åŒ–æˆåŠŸï¼");
}

void loop() {
}
									Arduinoå‘é€æ•°æ®ç»™ESP32

#include <SoftwareSerial.h>
#include <MHZ19.h>

// ä¼ æ„Ÿå™¨å¼•è„šå®šä¹‰
#define MQ2_PIN A0       // MQ-2 (å¯ç‡ƒæ°”ä½“)
#define CO_PIN A1        // MICS-6814 CO (ä¸€æ°§åŒ–ç¢³)
#define NO2_PIN A2       // MICS-6814 NOâ‚‚ (äºŒæ°§åŒ–æ°®)
#define NH3_PIN A3       // MICS-6814 NHâ‚ƒ (æ°¨æ°”)

// MH-Z19B COâ‚‚ ä¼ æ„Ÿå™¨å¼•è„š
#define RX_PIN 10        // Arduino RX (æ¥ MH-Z19 TX)
#define TX_PIN 11        // Arduino TX (æ¥ MH-Z19 RX)

// è¿æ¥ ESP32 çš„ä¸²å£
#define ESP_TX 3         // Arduino TX (è¿æ¥ ESP32 RX)
#define ESP_RX 2         // Arduino RX (è¿æ¥ ESP32 TX)

// åˆå§‹åŒ–ä¸²å£
SoftwareSerial mySerial(RX_PIN, TX_PIN);
SoftwareSerial espSerial(ESP_RX, ESP_TX);
MHZ19 myMHZ19;

void setup() {
    Serial.begin(115200);        // PC ä¸²å£ç›‘è§†å™¨
    espSerial.begin(115200);     // è¿æ¥ ESP32 çš„ä¸²å£
    mySerial.begin(9600);        // MH-Z19B ä¸²å£
    myMHZ19.begin(mySerial);     // åˆå§‹åŒ– MH-Z19B

    Serial.println("Arduino å¯åŠ¨...");
    delay(3000); // ä¼ æ„Ÿå™¨é¢„çƒ­
}

void loop() {
    // è¯»å– MQ-2 å¯ç‡ƒæ°”ä½“ä¼ æ„Ÿå™¨
    int mq2Value = analogRead(MQ2_PIN);
    
    // è¯»å– MICS-6814 å¤šæ°”ä½“ä¼ æ„Ÿå™¨
    int coValue = analogRead(CO_PIN);
    int no2Value = analogRead(NO2_PIN);
    int nh3Value = analogRead(NH3_PIN);

    // è¯»å– MH-Z19B COâ‚‚ ä¼ æ„Ÿå™¨
    int co2ppm = myMHZ19.getCO2();

    // å‘é€æ•°æ®ç»™ ESP32
    espSerial.print(mq2Value);
    espSerial.print(",");
    espSerial.print(coValue);
    espSerial.print(",");
    espSerial.print(no2Value);
    espSerial.print(",");
    espSerial.print(nh3Value);
    espSerial.print(",");
    espSerial.println(co2ppm);

    // åœ¨ PC ä¸²å£ç›‘è§†å™¨ä¸Šæ˜¾ç¤º
    Serial.println("====================================");
    Serial.print("å¯ç‡ƒæ°”ä½“ (MQ-2): ");
    Serial.println(mq2Value);
    
    Serial.print("CO (MICS-6814): ");
    Serial.println(coValue);

    Serial.print("NOâ‚‚ (MICS-6814): ");
    Serial.println(no2Value);

    Serial.print("NHâ‚ƒ (MICS-6814): ");
    Serial.println(nh3Value);

    Serial.print("COâ‚‚ (MH-Z19B): ");
    Serial.print(co2ppm);
    Serial.println(" ppm");

    Serial.println("====================================");

    // æ¯ 10 ç§’æ›´æ–°ä¸€æ¬¡
    delay(10000);
}
										ESP32æ”¶åˆ°æ‰€æœ‰æ•°æ®
#include <Arduino.h>

// è¿æ¥ Arduino çš„ä¸²å£
#define RX_PIN 4  // ESP32 RX (è¿æ¥ Arduino TX)
#define TX_PIN 17  // ESP32 TX (è¿æ¥ Arduino RX)

// åˆå§‹åŒ– Serial2ï¼ˆç”¨äºå’Œ Arduino é€šä¿¡ï¼‰
void setup() {
    Serial.begin(115200);    // ESP32 ä¸²å£ç›‘è§†å™¨
    Serial2.begin(115200, SERIAL_8N1, RX_PIN, TX_PIN); // è®¾ç½® Serial2 ä¸²å£
    Serial.println("ESP32 å¼€å§‹æ¥æ”¶æ•°æ®...");
}

void loop() {
    if (Serial2.available()) {
        String data = Serial2.readStringUntil('\n');  // è¯»å– Arduino å‘é€çš„æ•°æ®
        Serial.println("æ”¶åˆ°æ•°æ®: " + data);

        // è§£ææ•°æ®
        int values[5];  // å­˜å‚¨ä¼ æ„Ÿå™¨æ•°æ®
        int index = 0;
        char *ptr = strtok((char*)data.c_str(), ",");
        while (ptr != NULL && index < 5) {
            values[index++] = atoi(ptr);
            ptr = strtok(NULL, ",");
        }

        // ç¡®ä¿æ•°æ®å®Œæ•´
        if (index == 5) {
            Serial.println("====================================");
            Serial.print("å¯ç‡ƒæ°”ä½“ (MQ-2): ");
            Serial.println(values[0]);

            Serial.print("CO (MICS-6814): ");
            Serial.println(values[1]);

            Serial.print("NOâ‚‚ (MICS-6814): ");
            Serial.println(values[2]);

            Serial.print("NHâ‚ƒ (MICS-6814): ");
            Serial.println(values[3]);

            Serial.print("COâ‚‚ (MH-Z19B): ");
            Serial.print(values[4]);
            Serial.println(" ppm");

            Serial.println("====================================");
        } else {
            Serial.println("âš ï¸  æ•°æ®è§£æé”™è¯¯!");
        }
    }

    delay(10000);  // æ¯ 10 ç§’æ›´æ–°ä¸€æ¬¡
}
									ESP32å±•ç¤ºæ•°æ®
#include <Arduino.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

// è¿æ¥ Arduino çš„ä¸²å£
#define RX_PIN 4  // ESP32 RX (è¿æ¥ Arduino TX)
#define TX_PIN 17 // ESP32 TX (è¿æ¥ Arduino RX)

// OLED å±å¹•é…ç½®
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET -1
#define SCREEN_ADDRESS 0x3C

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

void setupDisplay() {
    if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
        Serial.println(F("âš ï¸  OLED æ˜¾ç¤ºåˆå§‹åŒ–å¤±è´¥!"));
        for (;;);
    }
    display.clearDisplay();
    display.setTextSize(1);
    display.setTextColor(SSD1306_WHITE);
    display.display();
}

void displaySensorData(int values[]) {
    display.clearDisplay();

    display.setCursor(0, 0);
    display.print("MQ-2: ");
    display.print(values[0]);

    display.setCursor(0, 10);
    display.print("CO: ");
    display.print(values[1]);

    display.setCursor(0, 20);
    display.print("NO2: ");
    display.print(values[2]);

    display.setCursor(0, 30);
    display.print("NH3: ");
    display.print(values[3]);

    display.setCursor(0, 40);
    display.print("CO2: ");
    display.print(values[4]);
    display.print(" ppm");

    display.display();
}

void setup() {
    Serial.begin(115200);
    Serial2.begin(115200, SERIAL_8N1, RX_PIN, TX_PIN);
    Serial.println("ESP32 å¼€å§‹æ¥æ”¶æ•°æ®...");
    setupDisplay();
}

void loop() {
    if (Serial2.available()) {
        String data = Serial2.readStringUntil('\n');  
        Serial.println("æ”¶åˆ°æ•°æ®: " + data);

        int values[5];  
        int index = 0;
        char *ptr = strtok((char*)data.c_str(), ",");
        while (ptr != NULL && index < 5) {
            values[index++] = atoi(ptr);
            ptr = strtok(NULL, ",");
        }

        if (index == 5) {
            Serial.println("====================================");
            Serial.print("MQ-2: "); Serial.println(values[0]);
            Serial.print("CO: "); Serial.println(values[1]);
            Serial.print("NO2: "); Serial.println(values[2]);
            Serial.print("NH3: "); Serial.println(values[3]);
            Serial.print("CO2: "); Serial.print(values[4]); Serial.println(" ppm");
            Serial.println("====================================");

            displaySensorData(values);
        } else {
            Serial.println("âš ï¸ æ•°æ®è§£æé”™è¯¯!");
        }
    }
    delay(10000);
}
									ESP32æ”¶åˆ°æ‰€æœ‰æ•°æ®
#include <Arduino.h>
#include <SdsDustSensor.h>

// ========== å¼•è„šå®šä¹‰ ==========
// Arduino ä¸²å£
#define ARDUINO_RX_PIN 4   // Arduino TX -> ESP32 GPIO4
#define ARDUINO_TX_PIN 17  // Arduino RX -> ESP32 GPIO17 (è‹¥éœ€è¦åŒå‘é€šä¿¡)

// SDS011 ä¸²å£
#define SDS011_RX_PIN 25   // SDS011 TX -> ESP32 GPIO25
#define SDS011_TX_PIN 26   // SDS011 RX -> ESP32 GPIO26

// ========== åˆ›å»º SDS011 ä¼ æ„Ÿå™¨å¯¹è±¡ ==========
HardwareSerial sdsSerial(1);
SdsDustSensor sds011(sdsSerial);

// ç”¨äºä¿å­˜ Arduino å‘æ¥çš„ 5 é¡¹æ•°æ®
int lastArduinoValues[5] = {0, 0, 0, 0, 0};

// ç»Ÿä¸€æ•°æ®è¯»å–å®šæ—¶ï¼ˆæ¯ 10 ç§’ä¸€æ¬¡ï¼‰
unsigned long previousTime = 0;
const unsigned long interval = 10000; // 10ç§’

void setup() {
    Serial.begin(115200);
    Serial.println("===== ESP32: å¼€å§‹è¿è¡Œ =====");

    // åˆå§‹åŒ– Arduino æ•°æ®ä¸²å£ (Serial2)
    Serial2.begin(115200, SERIAL_8N1, ARDUINO_RX_PIN, ARDUINO_TX_PIN);
    Serial.println("Serial2 (Arduino) åˆå§‹åŒ–æˆåŠŸ.");

    // åˆå§‹åŒ– SDS011 ä¸²å£ (HardwareSerial(1))
    sdsSerial.begin(9600, SERIAL_8N1, SDS011_RX_PIN, SDS011_TX_PIN);
    Serial.println("HardwareSerial(1) (SDS011) åˆå§‹åŒ–æˆåŠŸ.");

    // åˆå§‹åŒ– SDS011 ä¼ æ„Ÿå™¨ï¼ˆæ ¹æ®åº“çš„è¦æ±‚ï¼Œè°ƒç”¨å¯¹åº”å‡½æ•°ï¼‰
    sds011.setActiveReportingMode(); // æˆ–è€…ç”¨ setQueryReportingMode() è§†åº“ç‰ˆæœ¬è€Œå®š

    Serial.println("===== åˆå§‹åŒ–å®Œæˆï¼Œå¼€å§‹è¯»å–æ•°æ® =====");
}

void loop() {
    if (millis() - previousTime >= interval) {
        previousTime = millis();

        // ------------- æŸ¥è¯¢ SDS011 æ•°æ® -------------
        PmResult pm = sds011.queryPm();
        if (pm.isOk()) {
            Serial.println("----- SDS011 ä¼ æ„Ÿå™¨æ•°æ® -----");
            Serial.printf("PM2.5: %.1f Âµg/mÂ³\n", pm.pm25);
            Serial.printf("PM10 : %.1f Âµg/mÂ³\n", pm.pm10);
            Serial.println("----------------------------");
        } else {
            Serial.println("SDS011 æ•°æ®è¯»å–å¤±è´¥æˆ–æ— æ•ˆ.");
        }

        // ------------- è¯»å– Arduino æ•°æ® -------------
        if (Serial2.available()) {
            String data = Serial2.readStringUntil('\n');
            Serial.println("æ”¶åˆ° Arduino æ•°æ®: " + data);

            // è§£æé€—å·åˆ†éš”çš„ 5 é¡¹æ•°æ®
            int values[5];
            int index = 0;
            char *ptr = strtok((char*)data.c_str(), ",");
            while (ptr != NULL && index < 5) {
                values[index++] = atoi(ptr);
                ptr = strtok(NULL, ",");
            }
            if (index == 5) {
                for (int i = 0; i < 5; i++) {
                    lastArduinoValues[i] = values[i];
                }
                Serial.println("----- Arduino ä¼ æ„Ÿå™¨æ•°æ® -----");
                Serial.printf("MQ-2: %d\n", values[0]);
                Serial.printf("CO  : %d\n", values[1]);
                Serial.printf("NO2 : %d\n", values[2]);
                Serial.printf("NH3 : %d\n", values[3]);
                Serial.printf("CO2 : %d ppm\n", values[4]);
                Serial.println("----------------------------");
            } else {
                Serial.println("âš ï¸ Arduino æ•°æ®è§£æé”™è¯¯!");
            }
        } else {
            Serial.println("æœªæ”¶åˆ° Arduino æ•°æ®.");
        }
    }
    
    // å°å»¶æ—¶ï¼Œé˜²æ­¢å¾ªç¯è¿‡å¿«
    delay(100);
}
									ESP32å±•ç¤ºæ‰€æœ‰æ•°æ®
#include <Arduino.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <SdsDustSensor.h>

// ========== OLED å±å¹•é…ç½®ï¼ˆæŒ‰ç…§ä½ æä¾›çš„ä»£ç ï¼‰ ==========
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET -1
#define SCREEN_ADDRESS 0x3C

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

void setupDisplay() {
  if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
    Serial.println(F("âš ï¸  OLED æ˜¾ç¤ºåˆå§‹åŒ–å¤±è´¥!"));
    for (;;);
  }
  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);
  display.display();
}

// ========== ä¸²å£å®šä¹‰ ==========
#define RX_PIN 4   // ESP32 RXï¼ˆè¿æ¥ Arduino TXï¼‰
#define TX_PIN 17  // ESP32 TXï¼ˆè¿æ¥ Arduino RXï¼‰

// SDS011 ä¸²å£å®šä¹‰
#define SDS011_RX_PIN 25  // SDS011 TX -> ESP32 GPIO25
#define SDS011_TX_PIN 26  // SDS011 RX -> ESP32 GPIO26

// ========== å…¨å±€æ•°æ®å˜é‡ ==========
int arduinoValues[5] = {0, 0, 0, 0, 0}; // å­˜å‚¨ Arduino æ•°æ®ï¼šMQ-2, CO, NO2, NH3, CO2
float pm25 = 0.0, pm10 = 0.0;            // SDS011 æ•°æ®

// ========== é¡µé¢åˆ‡æ¢æ§åˆ¶ ==========
int currentPage = 0;          // 0ï¼šArduino æ•°æ®é¡µï¼Œ1ï¼šSDS011 æ•°æ®é¡µ
const int totalPages = 2;     

// ========== å®šæ—¶å™¨ ==========
unsigned long previousDataTime = 0;
const unsigned long dataInterval = 10000; // æ•°æ®åˆ·æ–°å‘¨æœŸï¼š10ç§’

unsigned long previousPageTime = 0;
const unsigned long pageInterval = 5000;    // é¡µé¢åˆ‡æ¢å‘¨æœŸï¼š5ç§’

// ========== OLED æ•°æ®æ˜¾ç¤ºå‡½æ•° ==========
// æ˜¾ç¤º Arduino æ•°æ®é¡µï¼ˆå¸ƒå±€ä¸ä½ æä¾›çš„ä»£ç ä¸€è‡´ï¼‰
void displayArduinoData() {
  display.clearDisplay();

  display.setCursor(0, 0);
  display.print("MQ-2: ");
  display.print(arduinoValues[0]);

  display.setCursor(0, 10);
  display.print("CO: ");
  display.print(arduinoValues[1]);

  display.setCursor(0, 20);
  display.print("NO2: ");
  display.print(arduinoValues[2]);

  display.setCursor(0, 30);
  display.print("NH3: ");
  display.print(arduinoValues[3]);

  display.setCursor(0, 40);
  display.print("CO2: ");
  display.print(arduinoValues[4]);
  display.print(" ppm");

  display.display();
}

// æ˜¾ç¤º SDS011 æ•°æ®é¡µ
void displaySDS011Data() {
  display.clearDisplay();

  display.setCursor(0, 0);
  display.print("PM2.5: ");
  display.print(pm25, 1);
  display.print(" ug/m3");

  display.setCursor(0, 10);
  display.print("PM10: ");
  display.print(pm10, 1);
  display.print(" ug/m3");

  display.display();
}

// æ ¹æ®å½“å‰é¡µå·æ›´æ–°æ˜¾ç¤º
void updateDisplay() {
  if (currentPage == 0) {
    displayArduinoData();
  } else if (currentPage == 1) {
    displaySDS011Data();
  }
}

// ========== SDS011 ä¼ æ„Ÿå™¨å¯¹è±¡ ==========
HardwareSerial sdsSerial(1);  // ä½¿ç”¨ UART1
SdsDustSensor sds011(sdsSerial);

void setup() {
  Serial.begin(115200);
  Serial.println("ESP32 å¼€å§‹è¿è¡Œ...");

  // åˆå§‹åŒ– OLED æ˜¾ç¤ºå±
  setupDisplay();

  // åˆå§‹åŒ– Arduino æ•°æ®ä¸²å£ï¼ˆSerial2ï¼‰
  Serial2.begin(115200, SERIAL_8N1, RX_PIN, TX_PIN);
  Serial.println("Serial2 (Arduino) åˆå§‹åŒ–æˆåŠŸ.");

  // åˆå§‹åŒ– SDS011 ä¸²å£ï¼ˆä½¿ç”¨ HardwareSerial(1)ï¼‰
  sdsSerial.begin(9600, SERIAL_8N1, SDS011_RX_PIN, SDS011_TX_PIN);
  Serial.println("SDS011 ä¸²å£åˆå§‹åŒ–æˆåŠŸ.");
  sds011.setActiveReportingMode();

  previousDataTime = millis();
  previousPageTime = millis();

  // åˆå§‹æ˜¾ç¤º Arduino æ•°æ®é¡µ
  currentPage = 0;
  updateDisplay();
}

void loop() {
  unsigned long currentMillis = millis();

  // æ¯10ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®
  if (currentMillis - previousDataTime >= dataInterval) {
    previousDataTime = currentMillis;

    // è¯»å– SDS011 æ•°æ®
    PmResult pm = sds011.queryPm();
    if (pm.isOk()) {
      pm25 = pm.pm25;
      pm10 = pm.pm10;
      Serial.printf("SDS011: PM2.5=%.1f ug/m3, PM10=%.1f ug/m3\n", pm25, pm10);
    } else {
      Serial.println("SDS011 æ•°æ®è¯»å–å¤±è´¥.");
    }

    // è¯»å– Arduino æ•°æ®ï¼ˆä» Serial2 è·å–ä¸€è¡Œé€—å·åˆ†éš”çš„æ•°æ®ï¼‰
    if (Serial2.available()) {
      String data = Serial2.readStringUntil('\n');
      Serial.println("æ”¶åˆ° Arduino æ•°æ®: " + data);
      int values[5];
      int index = 0;
      char *ptr = strtok((char*)data.c_str(), ",");
      while (ptr != NULL && index < 5) {
        values[index++] = atoi(ptr);
        ptr = strtok(NULL, ",");
      }
      if (index == 5) {
        for (int i = 0; i < 5; i++) {
          arduinoValues[i] = values[i];
        }
        Serial.printf("Arduino: %d, %d, %d, %d, %d\n",
                      arduinoValues[0], arduinoValues[1],
                      arduinoValues[2], arduinoValues[3],
                      arduinoValues[4]);
      } else {
        Serial.println("Arduino æ•°æ®è§£æé”™è¯¯!");
      }
    } else {
      Serial.println("æœªæ”¶åˆ° Arduino æ•°æ®.");
    }

    // æ•°æ®åˆ·æ–°åé‡ç½®é¡µé¢ä¸º Arduino æ•°æ®é¡µ
    currentPage = 0;
    updateDisplay();
    previousPageTime = currentMillis;
  }

  // æ¯5ç§’åˆ‡æ¢ä¸€æ¬¡é¡µé¢
  if (currentMillis - previousPageTime >= pageInterval) {
    previousPageTime = currentMillis;
    currentPage = (currentPage + 1) % totalPages;
    updateDisplay();
  }

  delay(100);
}
										Server.jsä»£ç 
const express = require('express'); 
const bodyParser = require('body-parser');
const cors = require('cors');

const app = express();
app.use(bodyParser.json()); // è§£æ JSON æ•°æ®
app.use(cors());

let sensorData = {};

// å¤„ç† ESP32 æ•°æ®ä¸Šä¼ 
app.post('/upload', (req, res) => {
  console.log("ğŸ“© æ”¶åˆ°æ•°æ®:", req.body);

  // éªŒè¯æ•°æ®æ ¼å¼
  if (!req.body || typeof req.body !== 'object') {
    return res.status(400).json({ error: "æ•°æ®æ ¼å¼é”™è¯¯: å¿…é¡»ä¸º JSON" });
  }

  sensorData = { ...req.body, timestamp: new Date().toISOString() };
  console.log("âœ… æœ€æ–°æ•°æ®:", sensorData);
  res.json({ message: "æ•°æ®æ¥æ”¶æˆåŠŸ" });
});

// æä¾›æœ€æ–°æ•°æ®
app.get('/data', (req, res) => {
  res.json(sensorData);
});

app.listen(3000, () => {
  console.log("ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000");
});
									å‰ç«¯SensorData.vue
<template>
  <div class="sensor-data">
    <h2>ä¼ æ„Ÿå™¨æ•°æ®</h2>
    <p>MQ-2: {{ sensorData.mq2 }} ppm</p>
    <p>CO: {{ sensorData.co }} ppm</p>
    <p>NO2: {{ sensorData.no2 }} ppb</p>
    <p>NH3: {{ sensorData.nh3 }} ppb</p>
    <p>CO2: {{ sensorData.co2 }} ppm</p>
    <p>PM2.5: {{ sensorData.pm25 }} Âµg/mÂ³</p>
    <p>PM10: {{ sensorData.pm10 }} Âµg/mÂ³</p>
    <p v-if="sensorData.timestamp">
      æ—¶é—´: {{ new Date(sensorData.timestamp).toLocaleString() }}
    </p>

    <button @click="fetchData">åˆ·æ–°æ•°æ®</button>
  </div>
</template>

<script>
import axios from 'axios'

export default {
  name: 'SensorData',
  data() {
    return {
      sensorData: {
        mq2: 0,
        co: 0,
        no2: 0,
        nh3: 0,
        co2: 0,
        pm25: 0,
        pm10: 0,
        timestamp: ''
      }
    }
  },
  methods: {
    fetchData() {
      axios.get('http://localhost:3000/data') 
        .then(response => {
          this.sensorData = response.data
        })
        .catch(err => {
          console.error('è·å–æ•°æ®å¤±è´¥:', err)
        })
    }
  },
  mounted() {
    // é¡µé¢åŠ è½½æ—¶å…ˆè·å–ä¸€æ¬¡æ•°æ®
    this.fetchData()
    // æ¯ 10 ç§’åˆ·æ–°ä¸€æ¬¡
    setInterval(this.fetchData, 10000)
  }
}
</script>

<style scoped>
.sensor-data {
  /* å®¹å™¨æ•´ä½“å±…ä¸­ + è°ƒå¤§å­—ä½“ */
  text-align: center;     /* æ°´å¹³å±…ä¸­å¯¹é½ */
  font-size: 24px;        /* æ•´ä½“å­—ä½“å¤§å° */
  line-height: 1.6;       /* è¡Œé—´è· */
  max-width: 600px;       /* å¯é€‰ï¼šè®¾å®šæœ€å¤§å®½åº¦ */
  margin: 0 auto;         /* å±…ä¸­å®¹å™¨ */
  padding: 20px;          /* é€‚å½“ç•™ç™½ */
}

.sensor-data h2 {
  font-size: 28px;        /* æ ‡é¢˜æ›´å¤§ä¸€ç‚¹ */
  margin-bottom: 20px;
}

.sensor-data p {
  margin: 8px 0;          /* æ®µè½ä¹‹é—´ç¨å¾®ç•™ç‚¹é—´éš” */
}

.sensor-data button {
  font-size: 20px;
  padding: 10px 20px;
  margin-top: 20px;
  cursor: pointer;
}
</style>
									ESP32ä¸Šä¼ å®Œæ•´ä»£ç 
#include <Arduino.h>
#include <WiFi.h>
#include <HTTPClient.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <SdsDustSensor.h>

// ========== 1) WiFi é…ç½® ==========
const char* ssid = "HCSS";          // ä½ çš„ WiFi åç§°
const char* password = "123456789"; // ä½ çš„ WiFi å¯†ç 
const char* serverUrl = "http://192.168.137.1:3000/upload"; // ä½ çš„æœåŠ¡å™¨åœ°å€

// ========== 2) OLED å±å¹•é…ç½®ï¼ˆä¸ä½ æä¾›çš„ä»£ç ä¸€è‡´ï¼‰ ==========
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET   -1
#define SCREEN_ADDRESS 0x3C

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

void setupDisplay() {
  if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
    Serial.println(F("âš ï¸  OLED æ˜¾ç¤ºåˆå§‹åŒ–å¤±è´¥!"));
    for (;;);
  }
  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);
  display.display();
}

// ========== 3) ä¸²å£å®šä¹‰ ==========
// 3.1) Arduino æ•°æ®ä¸²å£
#define ARDUINO_RX_PIN 4   // Arduino TX -> ESP32 GPIO4
#define ARDUINO_TX_PIN 17  // Arduino RX -> ESP32 GPIO17ï¼ˆè‹¥éœ€è¦åŒå‘é€šä¿¡å†ç”¨ï¼‰
// 3.2) SDS011 æ•°æ®ä¸²å£
#define SDS011_RX_PIN 25   // SDS011 TX -> ESP32 GPIO25
#define SDS011_TX_PIN 26   // SDS011 RX -> ESP32 GPIO26

// ========== 4) å…¨å±€æ•°æ®å˜é‡ ==========
// 4.1) Arduino ä¼ æ„Ÿå™¨æ•°æ®ï¼ˆ5 é¡¹ï¼‰
int arduinoValues[5] = {0, 0, 0, 0, 0}; // MQ-2, CO, NO2, NH3, CO2
// 4.2) SDS011 æ•°æ®
float pm25 = 0.0, pm10 = 0.0;

// ========== 5) åˆ†å±æ˜¾ç¤ºæ§åˆ¶ ==========
// ä¸¤é¡µï¼š0=Arduino æ•°æ®é¡µï¼Œ1=SDS011 æ•°æ®é¡µ
int currentPage = 0;
const int totalPages = 2;

// ========== 6) å®šæ—¶å™¨ ==========
unsigned long previousDataTime = 0;
const unsigned long dataInterval = 10000; // æ¯ 10 ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®

unsigned long previousPageTime = 0;
const unsigned long pageInterval = 5000;  // æ¯ 5 ç§’åˆ‡æ¢ä¸€æ¬¡é¡µé¢

// ========== 7) OLED æ˜¾ç¤ºå‡½æ•° ==========
void displayArduinoData() {
  display.clearDisplay();
  display.setCursor(0, 0);
  display.print("MQ-2: ");
  display.print(arduinoValues[0]);

  display.setCursor(0, 10);
  display.print("CO: ");
  display.print(arduinoValues[1]);

  display.setCursor(0, 20);
  display.print("NO2: ");
  display.print(arduinoValues[2]);

  display.setCursor(0, 30);
  display.print("NH3: ");
  display.print(arduinoValues[3]);

  display.setCursor(0, 40);
  display.print("CO2: ");
  display.print(arduinoValues[4]);
  display.print(" ppm");

  display.display();
}

void displaySDS011Data() {
  display.clearDisplay();
  display.setCursor(0, 0);
  display.print("PM2.5: ");
  display.print(pm25, 1);
  display.print(" ug/m3");

  display.setCursor(0, 10);
  display.print("PM10: ");
  display.print(pm10, 1);
  display.print(" ug/m3");

  display.display();
}

void updateDisplay() {
  if (currentPage == 0) {
    displayArduinoData();
  } else {
    displaySDS011Data();
  }
}

// ========== 8) SDS011 ä¼ æ„Ÿå™¨å¯¹è±¡ ==========
HardwareSerial sdsSerial(1); // ä½¿ç”¨ç¡¬ä»¶ä¸²å£ UART1
SdsDustSensor sds011(sdsSerial);

// ========== 9) WiFi å‘é€å‡½æ•° ==========
void sendToServer() {
  // æ„é€  JSON æ•°æ®ï¼Œå°† Arduino å’Œ SDS011 æ•°æ®æ•´åˆåˆ°ä¸€èµ·
  // ä¾‹å¦‚ï¼š{"mq2":123,"co":456,"no2":789,"nh3":111,"co2":222,"pm25":3.4,"pm10":5.6}
  String jsonData = "{";
  jsonData += "\"mq2\":"  + String(arduinoValues[0]) + ",";
  jsonData += "\"co\":"   + String(arduinoValues[1]) + ",";
  jsonData += "\"no2\":"  + String(arduinoValues[2]) + ",";
  jsonData += "\"nh3\":"  + String(arduinoValues[3]) + ",";
  jsonData += "\"co2\":"  + String(arduinoValues[4]) + ",";
  jsonData += "\"pm25\":" + String(pm25, 1) + ",";
  jsonData += "\"pm10\":" + String(pm10, 1);
  jsonData += "}";

  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;
    http.begin(serverUrl);
    http.addHeader("Content-Type", "application/json");

    Serial.print("ğŸ“¤ Sending JSON: ");
    Serial.println(jsonData);

    int httpResponseCode = http.POST(jsonData);
    Serial.print("ğŸ“¡ HTTP Response Code: ");
    Serial.println(httpResponseCode);

    http.end();
  } else {
    Serial.println("âŒ WiFi not connected!");
  }
}

void setup() {
  // ====== 1) ä¸²å£è°ƒè¯• ======
  Serial.begin(115200);
  Serial.println("===== ESP32: Starting =====");

  // ====== 2) OLED åˆå§‹åŒ– ======
  setupDisplay();

  // ====== 3) WiFi è¿æ¥ ======
  Serial.print("æ­£åœ¨è¿æ¥ WiFi: ");
  Serial.println(ssid);
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nâœ… WiFi Connected!");
  Serial.print("ğŸ“¡ IP Address: ");
  Serial.println(WiFi.localIP());

  // ====== 4) ä¸²å£åˆå§‹åŒ– ======
  // 4.1) Arduino æ•°æ®ä¸²å£ (Serial2)
  Serial2.begin(115200, SERIAL_8N1, ARDUINO_RX_PIN, ARDUINO_TX_PIN);
  Serial.println("Serial2 (Arduino) initialized.");

  // 4.2) SDS011 ä¸²å£ (HardwareSerial(1))
  sdsSerial.begin(9600, SERIAL_8N1, SDS011_RX_PIN, SDS011_TX_PIN);
  Serial.println("SDS011 ä¸²å£åˆå§‹åŒ–æˆåŠŸ.");

  // ====== 5) SDS011 ä¼ æ„Ÿå™¨è®¾ç½® ======
  sds011.setActiveReportingMode(); // è‹¥éœ€è¦æŸ¥è¯¢æ¨¡å¼ï¼Œå¯æ”¹ä¸º setQueryReportingMode()

  // ====== 6) å®šæ—¶å™¨åˆå§‹åŒ– ======
  previousDataTime = millis();
  previousPageTime = millis();

  // åˆæ¬¡æ˜¾ç¤º Arduino æ•°æ®é¡µ
  currentPage = 0;
  updateDisplay();
}

void loop() {
  unsigned long currentMillis = millis();

  // ========== A. æ•°æ®åˆ·æ–°ï¼šæ¯ 10 ç§’ ==========
  if (currentMillis - previousDataTime >= dataInterval) {
    previousDataTime = currentMillis;

    // 1) è¯»å– SDS011
    PmResult pm = sds011.queryPm();
    if (pm.isOk()) {
      pm25 = pm.pm25;
      pm10 = pm.pm10;
      Serial.printf("SDS011: PM2.5=%.1f, PM10=%.1f\n", pm25, pm10);
    } else {
      Serial.println("SDS011 æ•°æ®è¯»å–å¤±è´¥.");
    }

    // 2) è¯»å– Arduino æ•°æ®ï¼ˆä» Serial2ï¼‰
    if (Serial2.available()) {
      String data = Serial2.readStringUntil('\n');
      Serial.println("æ”¶åˆ° Arduino æ•°æ®: " + data);
      int values[5];
      int index = 0;
      char *ptr = strtok((char*)data.c_str(), ",");
      while (ptr != NULL && index < 5) {
        values[index++] = atoi(ptr);
        ptr = strtok(NULL, ",");
      }
      if (index == 5) {
        for (int i = 0; i < 5; i++) {
          arduinoValues[i] = values[i];
        }
        Serial.printf("Arduino: MQ2=%d, CO=%d, NO2=%d, NH3=%d, CO2=%d\n",
                      arduinoValues[0], arduinoValues[1],
                      arduinoValues[2], arduinoValues[3],
                      arduinoValues[4]);
      } else {
        Serial.println("Arduino æ•°æ®è§£æé”™è¯¯!");
      }
    } else {
      Serial.println("æœªæ”¶åˆ° Arduino æ•°æ®.");
    }

    // 3) æ›´æ–° OLED æ˜¾ç¤ºåˆ° Arduino æ•°æ®é¡µ
    currentPage = 0;
    updateDisplay();
    previousPageTime = currentMillis;

    // 4) é€šè¿‡ WiFi å‘é€æ•°æ®åˆ°æœåŠ¡å™¨
    sendToServer();
  }

  // ========== B. é¡µé¢åˆ‡æ¢ï¼šæ¯ 5 ç§’ ==========
  if (currentMillis - previousPageTime >= pageInterval) {
    previousPageTime = currentMillis;
    currentPage = (currentPage + 1) % totalPages;
    updateDisplay();
  }

  delay(100);
}
									ESP32æœ€ç»ˆä»£ç 
#include <Arduino.h>
#include <WiFi.h>
#include <HTTPClient.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <SdsDustSensor.h>
#include <SPI.h>
#include <SD.h>
#include <time.h> // ç”¨äº NTP æ—¶é—´åŒæ­¥

// ========== 1) WiFi é…ç½® ==========
const char* ssid = "HCSS";          // ä½ çš„ WiFi åç§°
const char* password = "123456789"; // ä½ çš„ WiFi å¯†ç 
const char* serverUrl = "http://192.168.137.1:3000/upload"; // ä½ çš„æœåŠ¡å™¨åœ°å€

// ========== 2) NTP é…ç½® ==========
// å¯ä½¿ç”¨ä½ å–œæ¬¢çš„ NTP æœåŠ¡å™¨ï¼Œå¦‚ pool.ntp.org, ntp1.aliyun.com ç­‰
const char* ntpServer = "pool.ntp.org";
// æ—¶åŒºåç§» (ç§’)ï¼Œè¿™é‡Œæ˜¯ UTC+8 (ä¸­å›½)ï¼Œ8*3600 = 28800
const long gmtOffset_sec = 8 * 3600;
const int daylightOffset_sec = 0; // å›½å†…ä¸€èˆ¬æ— å¤ä»¤æ—¶

// ========== 3) OLED å±å¹•é…ç½® ==========
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET   -1
#define SCREEN_ADDRESS 0x3C

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

void setupDisplay() {
  if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
    Serial.println(F("âš ï¸  OLED æ˜¾ç¤ºåˆå§‹åŒ–å¤±è´¥!"));
    for (;;);
  }
  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);
  display.display();
}

// ========== 4) ä¸²å£å®šä¹‰ ==========
// 4.1) Arduino æ•°æ®ä¸²å£
#define ARDUINO_RX_PIN 4   // Arduino TX -> ESP32 GPIO4
#define ARDUINO_TX_PIN 17  // Arduino RX -> ESP32 GPIO17ï¼ˆè‹¥éœ€è¦åŒå‘é€šä¿¡å†ç”¨ï¼‰
// 4.2) SDS011 æ•°æ®ä¸²å£
#define SDS011_RX_PIN 25   // SDS011 TX -> ESP32 GPIO25
#define SDS011_TX_PIN 26   // SDS011 RX -> ESP32 GPIO26

// ========== 5) å…¨å±€æ•°æ®å˜é‡ ==========
// Arduino ä¼ æ„Ÿå™¨æ•°æ®ï¼ˆ5 é¡¹: MQ-2, CO, NO2, NH3, CO2ï¼‰
int arduinoValues[5] = {0, 0, 0, 0, 0};
// SDS011 æ•°æ®
float pm25 = 0.0, pm10 = 0.0;

// ========== 6) åˆ†å±æ˜¾ç¤ºæ§åˆ¶ ==========
// ä¸¤é¡µï¼š0=Arduino æ•°æ®é¡µï¼Œ1=SDS011 æ•°æ®é¡µ
int currentPage = 0;
const int totalPages = 2;

// ========== 7) å®šæ—¶å™¨ ==========
unsigned long previousDataTime = 0;
const unsigned long dataInterval = 10000; // æ¯ 10 ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®

unsigned long previousPageTime = 0;
const unsigned long pageInterval = 5000;  // æ¯ 5 ç§’åˆ‡æ¢ä¸€æ¬¡é¡µé¢

// ========== 8) OLED æ˜¾ç¤ºå‡½æ•° ==========
void displayArduinoData() {
  display.clearDisplay();
  display.setCursor(0, 0);
  display.print("MQ-2: ");
  display.print(arduinoValues[0]);
  display.print(" ppm");

  display.setCursor(0, 10);
  display.print("CO: ");
  display.print(arduinoValues[1]);
  display.print(" ppm");

  display.setCursor(0, 20);
  display.print("NO2: ");
  display.print(arduinoValues[2]);
  display.print(" ppm");

  display.setCursor(0, 30);
  display.print("NH3: ");
  display.print(arduinoValues[3]);
  display.print(" ppm");

  display.setCursor(0, 40);
  display.print("CO2: ");
  display.print(arduinoValues[4]);
  display.print(" ppm");

  display.display();
}

void displaySDS011Data() {
  display.clearDisplay();
  display.setCursor(0, 0);
  display.print("PM2.5: ");
  display.print(pm25, 1);
  display.print(" ug/m3");

  display.setCursor(0, 10);
  display.print("PM10: ");
  display.print(pm10, 1);
  display.print(" ug/m3");

  display.display();
}

void updateDisplay() {
  if (currentPage == 0) {
    displayArduinoData();
  } else {
    displaySDS011Data();
  }
}

// ========== 9) SDS011 ä¼ æ„Ÿå™¨å¯¹è±¡ ==========
HardwareSerial sdsSerial(1);
SdsDustSensor sds011(sdsSerial);

// ========== 10) WiFi å‘é€å‡½æ•° ==========
void sendToServer() {
  // æ„é€  JSON æ•°æ®
  String jsonData = "{";
  jsonData += "\"mq2\":"  + String(arduinoValues[0]) + ",";
  jsonData += "\"co\":"   + String(arduinoValues[1]) + ",";
  jsonData += "\"no2\":"  + String(arduinoValues[2]) + ",";
  jsonData += "\"nh3\":"  + String(arduinoValues[3]) + ",";
  jsonData += "\"co2\":"  + String(arduinoValues[4]) + ",";
  jsonData += "\"pm25\":" + String(pm25, 1) + ",";
  jsonData += "\"pm10\":" + String(pm10, 1);
  jsonData += "}";

  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;
    http.begin(serverUrl);
    http.addHeader("Content-Type", "application/json");

    Serial.print("ğŸ“¤ Sending JSON: ");
    Serial.println(jsonData);

    int httpResponseCode = http.POST(jsonData);
    Serial.print("ğŸ“¡ HTTP Response Code: ");
    Serial.println(httpResponseCode);

    http.end();
  } else {
    Serial.println("âŒ WiFi not connected!");
  }
}

// ========== 11) SD å¡é…ç½® ==========
#define SD_CS_PIN 5
bool sdInitialized = false;

// ========== 12) èœ‚é¸£å™¨é˜ˆå€¼æŠ¥è­¦ ==========
// å‡è®¾ä½ ä½¿ç”¨æœ‰æºèœ‚é¸£å™¨æ¥ GPIO16ï¼Œé«˜ç”µå¹³å“
#define BUZZER_PIN 16

// è®¾å®šæŠ¥è­¦é˜ˆå€¼ï¼ˆå¯æ ¹æ®éœ€æ±‚è‡ªè¡Œè°ƒæ•´å•ä½ï¼‰
const int THRESHOLD_MQ2    = 400;
const int THRESHOLD_CO     = 500;
const int THRESHOLD_NO2    = 350;
const int THRESHOLD_NH3    = 300;
const int THRESHOLD_CO2    = 800;
const float THRESHOLD_PM25 = 10.0;
const float THRESHOLD_PM10 = 20.0;

bool needAlarm = false;

// ========== 13) NTP æ—¶é—´åŒæ­¥ç›¸å…³å‡½æ•° ==========
void setupTime() {
  configTime(gmtOffset_sec, daylightOffset_sec, ntpServer);
  Serial.print("æ­£åœ¨åŒæ­¥ç½‘ç»œæ—¶é—´");
  while (true) {
    time_t now = time(nullptr);
    // ç®€å•åˆ¤æ–­ now æ˜¯å¦å¤§äº 1970-01-01
    if (now > 8 * 3600) {
      Serial.println("\nâœ… æ—¶é—´åŒæ­¥æˆåŠŸ!");
      break;
    }
    Serial.print(".");
    delay(1000);
  }
}

// ========== 14) å†™å…¥ SD å¡å‡½æ•° ==========
// å†™å…¥ CSV: MQ2,CO,NO2,NH3,CO2,PM2.5,PM10,Time
void writeDataToSD() {
  if (!sdInitialized) return;

  File file = SD.open("/sensor_data.csv", FILE_APPEND);
  if (!file) {
    Serial.println("âŒ æ— æ³•æ‰“å¼€ sensor_data.csv è¿›è¡Œå†™å…¥!");
    return;
  }

  // å¦‚æœæ–‡ä»¶æ˜¯ç©ºçš„ï¼Œå…ˆå†™è¡¨å¤´
  if (file.size() == 0) {
    file.println("MQ2,CO,NO2,NH3,CO2,PM2.5,PM10,Time");
  }

  // è·å–å½“å‰æœ¬åœ°æ—¶é—´
  time_t now = time(nullptr);
  struct tm* timeinfo = localtime(&now);

  // æ ¼å¼åŒ–æ—¶é—´æˆå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ "2025-03-07 12:34:56"
  char timeString[25];
  strftime(timeString, sizeof(timeString), "%F %T", timeinfo);

  // å†™ CSV ä¸€è¡Œ
  file.print(arduinoValues[0]); file.print(",");
  file.print(arduinoValues[1]); file.print(",");
  file.print(arduinoValues[2]); file.print(",");
  file.print(arduinoValues[3]); file.print(",");
  file.print(arduinoValues[4]); file.print(",");
  file.print(pm25, 1);          file.print(",");
  file.print(pm10, 1);          file.print(",");
  file.println(timeString);

  file.close();
  Serial.println("âœ… æ•°æ®å·²å†™å…¥ sensor_data.csv");
}

// ========== 15) setup() å‡½æ•° ==========
void setup() {
  Serial.begin(115200);
  Serial.println("===== ESP32: Starting =====");

  // 1) OLED åˆå§‹åŒ–
  setupDisplay();

  // 2) WiFi è¿æ¥
  Serial.print("æ­£åœ¨è¿æ¥ WiFi: ");
  Serial.println(ssid);
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nâœ… WiFi Connected!");
  Serial.print("ğŸ“¡ IP Address: ");
  Serial.println(WiFi.localIP());

  // 3) åŒæ­¥ NTP æ—¶é—´
  setupTime();

  // 4) ä¸²å£åˆå§‹åŒ–
  // 4.1) Arduino æ•°æ®ä¸²å£ (Serial2)
  Serial2.begin(115200, SERIAL_8N1, ARDUINO_RX_PIN, ARDUINO_TX_PIN);
  Serial.println("Serial2 (Arduino) initialized.");

  // 4.2) SDS011 ä¸²å£ (HardwareSerial(1))
  sdsSerial.begin(9600, SERIAL_8N1, SDS011_RX_PIN, SDS011_TX_PIN);
  Serial.println("SDS011 ä¸²å£åˆå§‹åŒ–æˆåŠŸ.");

  // 5) SDS011 ä¼ æ„Ÿå™¨è®¾ç½®
  sds011.setActiveReportingMode();

  // 6) åˆå§‹åŒ–å®šæ—¶å™¨
  previousDataTime = millis();
  previousPageTime = millis();

  // 7) åˆå§‹åŒ–èœ‚é¸£å™¨å¼•è„š
  pinMode(BUZZER_PIN, OUTPUT);
  digitalWrite(BUZZER_PIN, LOW);

  // 8) åˆå§‹åŒ– SD å¡
  Serial.println("å°è¯•åˆå§‹åŒ– SD å¡...");
  if (!SD.begin(SD_CS_PIN)) {
    Serial.println("âš ï¸ SD å¡åˆå§‹åŒ–å¤±è´¥ï¼Œåç»­æ— æ³•å†™å…¥æ–‡ä»¶!");
    sdInitialized = false;
  } else {
    Serial.println("âœ… SD å¡åˆå§‹åŒ–æˆåŠŸ.");
    sdInitialized = true;
  }

  // é¦–æ¬¡æ˜¾ç¤º Arduino æ•°æ®é¡µ
  currentPage = 0;
  updateDisplay();
}

// ========== 16) loop() å‡½æ•° ==========
void loop() {
  unsigned long currentMillis = millis();

  // A. æ•°æ®åˆ·æ–°ï¼šæ¯ 10 ç§’
  if (currentMillis - previousDataTime >= dataInterval) {
    previousDataTime = currentMillis;

    // 1) è¯»å– SDS011
    PmResult pm = sds011.queryPm();
    if (pm.isOk()) {
      pm25 = pm.pm25;
      pm10 = pm.pm10;
      Serial.printf("SDS011: PM2.5=%.1f, PM10=%.1f\n", pm25, pm10);
    } else {
      Serial.println("SDS011 æ•°æ®è¯»å–å¤±è´¥.");
    }

    // 2) è¯»å– Arduino æ•°æ®ï¼ˆä» Serial2ï¼‰
    if (Serial2.available()) {
      String data = Serial2.readStringUntil('\n');
      Serial.println("æ”¶åˆ° Arduino æ•°æ®: " + data);
      int values[5];
      int index = 0;
      char *ptr = strtok((char*)data.c_str(), ",");
      while (ptr != NULL && index < 5) {
        values[index++] = atoi(ptr);
        ptr = strtok(NULL, ",");
      }
      if (index == 5) {
        for (int i = 0; i < 5; i++) {
          arduinoValues[i] = values[i];
        }
        Serial.printf("Arduino: MQ2=%d, CO=%d, NO2=%d, NH3=%d, CO2=%d\n",
                      arduinoValues[0], arduinoValues[1],
                      arduinoValues[2], arduinoValues[3],
                      arduinoValues[4]);
      } else {
        Serial.println("Arduino æ•°æ®è§£æé”™è¯¯!");
      }
    } else {
      Serial.println("æœªæ”¶åˆ° Arduino æ•°æ®.");
    }

    // 3) æ›´æ–° OLED æ˜¾ç¤ºåˆ° Arduino æ•°æ®é¡µ
    currentPage = 0;
    updateDisplay();
    previousPageTime = currentMillis;

    // 4) é€šè¿‡ WiFi å‘é€æ•°æ®åˆ°æœåŠ¡å™¨
    sendToServer();

    // 5) å†™å…¥ SD å¡ï¼ˆå¸¦ NTP æ—¶é—´ï¼‰
    writeDataToSD();

    // 6) åˆ¤æ–­æ˜¯å¦éœ€è¦æŠ¥è­¦
    needAlarm = false;
    if (arduinoValues[0] > THRESHOLD_MQ2)  needAlarm = true; // MQ2
    if (arduinoValues[1] > THRESHOLD_CO)   needAlarm = true; // CO
    if (arduinoValues[2] > THRESHOLD_NO2)  needAlarm = true; // NO2
    if (arduinoValues[3] > THRESHOLD_NH3)  needAlarm = true; // NH3
    if (arduinoValues[4] > THRESHOLD_CO2)  needAlarm = true; // CO2
    if (pm25 > THRESHOLD_PM25)             needAlarm = true; // PM2.5
    if (pm10 > THRESHOLD_PM10)             needAlarm = true; // PM10

    if (needAlarm) {
      Serial.println("âš ï¸ ä¼ æ„Ÿå™¨æ•°å€¼è¶…è¿‡é˜ˆå€¼ï¼ŒæŠ¥è­¦!");
      digitalWrite(BUZZER_PIN, HIGH);
    } else {
      Serial.println("æ•°å€¼æ­£å¸¸ï¼Œæ— éœ€æŠ¥è­¦.");
      digitalWrite(BUZZER_PIN, LOW);
    }
  }

  // B. é¡µé¢åˆ‡æ¢ï¼šæ¯ 5 ç§’
  if (currentMillis - previousPageTime >= pageInterval) {
    previousPageTime = currentMillis;
    currentPage = (currentPage + 1) % totalPages;
    updateDisplay();
  }

  delay(100);
}
                                                                           server.jsæ›´æ–°
// server.js
const express = require('express');
const bodyParser = require('body-parser');
const cors = require('cors');

const app = express();
app.use(bodyParser.json()); // è§£æ JSON æ•°æ®
app.use(cors());

// å…¨å±€å­˜å‚¨ä¼ æ„Ÿå™¨æ•°æ®
let sensorData = {};

// å¤„ç† ESP32 æ•°æ®ä¸Šä¼ 
app.post('/upload', (req, res) => {
  console.log("ğŸ“© æ”¶åˆ°æ•°æ®:", req.body);

  // éªŒè¯æ•°æ®æ ¼å¼
  if (!req.body || typeof req.body !== 'object') {
    return res.status(400).json({ error: "æ•°æ®æ ¼å¼é”™è¯¯: å¿…é¡»ä¸º JSON" });
  }

  // ç»™æ•°æ®åŠ ä¸ªæ—¶é—´æˆ³
  sensorData = { ...req.body, timestamp: new Date().toISOString() };
  console.log("âœ… æœ€æ–°æ•°æ®:", sensorData);
  res.json({ message: "æ•°æ®æ¥æ”¶æˆåŠŸ" });
});

// æä¾›æœ€æ–°æ•°æ®
app.get('/data', (req, res) => {
  res.json(sensorData);
});

// ç›‘å¬ 3000 ç«¯å£ï¼Œç»‘å®šåˆ° 0.0.0.0ï¼ˆå³æ‰€æœ‰ç½‘å¡ï¼‰
const PORT = 3000;
app.listen(PORT, '0.0.0.0', () => {
  console.log(`ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://0.0.0.0:${PORT}`);
  console.log(`ä¹Ÿå¯é€šè¿‡ä½ çš„å±€åŸŸç½‘ IP (å¦‚ http://192.168.137.1:${PORT}) è®¿é—®`);
});
										SensorData.vueæ›´æ–°
<template>
  <div class="sensor-data">
    <h2>ä¼ æ„Ÿå™¨æ•°æ®</h2>
    <p>MQ-2: {{ sensorData.mq2 }} ppm</p>
    <p>CO: {{ sensorData.co }} ppm</p>
    <p>NO2: {{ sensorData.no2 }} ppb</p>
    <p>NH3: {{ sensorData.nh3 }} ppb</p>
    <p>CO2: {{ sensorData.co2 }} ppm</p>
    <p>PM2.5: {{ sensorData.pm25 }} Âµg/mÂ³</p>
    <p>PM10: {{ sensorData.pm10 }} Âµg/mÂ³</p>
    <p v-if="sensorData.timestamp">
      æ—¶é—´: {{ new Date(sensorData.timestamp).toLocaleString() }}
    </p>

    <button @click="fetchData">åˆ·æ–°æ•°æ®</button>
  </div>
</template>

<script>
import axios from 'axios'

export default {
  name: 'SensorData',
  data() {
    return {
      sensorData: {
        mq2: 0,
        co: 0,
        no2: 0,
        nh3: 0,
        co2: 0,
        pm25: 0,
        pm10: 0,
        timestamp: ''
      }
    }
  },
  methods: {
    fetchData() {
      // æ”¹ä¸ºä½ çš„ç”µè„‘å±€åŸŸç½‘ IP
      axios.get('http://192.168.137.1:3000/data')
        .then(response => {
          this.sensorData = response.data
        })
        .catch(err => {
          console.error('è·å–æ•°æ®å¤±è´¥:', err)
        })
    }
  },
  mounted() {
    // é¡µé¢åŠ è½½æ—¶å…ˆè·å–ä¸€æ¬¡æ•°æ®
    this.fetchData()
    // æ¯ 10 ç§’åˆ·æ–°ä¸€æ¬¡
    setInterval(this.fetchData, 10000)
  }
}
</script>

<style scoped>
.sensor-data {
  text-align: center;
  font-size: 24px;
  line-height: 1.6;
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
}

.sensor-data h2 {
  font-size: 28px;
  margin-bottom: 20px;
}

.sensor-data p {
  margin: 8px 0;
}

.sensor-data button {
  font-size: 20px;
  padding: 10px 20px;
  margin-top: 20px;
  cursor: pointer;
}
</style>
											APP.vue
<template>
  <nav>
    <router-link to="/">Home</router-link> |
    <router-link to="/about">About</router-link>
  </nav>
  <router-view/>
</template>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
}

nav {
  padding: 30px;
}

nav a {
  font-weight: bold;
  color: #2c3e50;
}

nav a.router-link-exact-active {
  color: #42b983;
}
</style>
									å‘é€æ¨ç‰¹pythonä»£ç 
import tweepy
import requests
import time

# ===== Twitter API Credentials =====
API_KEY = "riyh19wa6IgBUKD5GJ18fQqKl"
API_SECRET = "vN61tj78xAYyKsipy4DLUEqaWSABMB1byvV2e2gbLHDo3GScmT"
ACCESS_TOKEN = "1901762964652265472-W0PPKMqxQuIQdqVhfuoTHO0tTYDBxD"
ACCESS_TOKEN_SECRET = "917zEhhM51nFLbTYryreh741ZLJL9GQmSG80qya0sVHm6"

# ===== æœåŠ¡å™¨æ•°æ®æ¥å£ =====
# è¯·ç¡®ä¿è¯¥åœ°å€ä¸ä½ çš„æœåŠ¡å™¨å®é™…åœ°å€ä¸€è‡´
SERVER_DATA_URL = "http://192.168.137.1:3000/data"

def get_sensor_data():
    """
    ä»æœåŠ¡å™¨è·å–æœ€æ–°çš„ä¼ æ„Ÿå™¨æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰
    """
    try:
        response = requests.get(SERVER_DATA_URL, timeout=10)
        response.raise_for_status()
        data = response.json()
        return data
    except Exception as e:
        print("Error fetching sensor data:", e)
        return None

def format_tweet(data):
    """
    å°†ä¼ æ„Ÿå™¨æ•°æ®æ ¼å¼åŒ–æˆæ¨æ–‡æ–‡æœ¬
    """
    if not data:
        return "No sensor data available."
    tweet = (
        f"Sensor Data:\n"
        f"MQ-2: {data.get('mq2', 'N/A')} ppm\n"
        f"CO: {data.get('co', 'N/A')} ppm\n"
        f"NO2: {data.get('no2', 'N/A')} ppb\n"
        f"NH3: {data.get('nh3', 'N/A')} ppb\n"
        f"CO2: {data.get('co2', 'N/A')} ppm\n"
        f"PM2.5: {data.get('pm25', 'N/A')} Âµg/mÂ³\n"
        f"PM10: {data.get('pm10', 'N/A')} Âµg/mÂ³\n"
        f"Time: {data.get('timestamp', 'N/A')}"
    )
    return tweet

def post_tweet(api, tweet_text):
    """
    ä½¿ç”¨ Twitter API å‘å¸ƒæ¨æ–‡
    """
    try:
        api.update_status(tweet_text)
        print("Tweet posted successfully!")
    except Exception as e:
        print("Error posting tweet:", e)

def main():
    # è®¾ç½® Twitter API è®¤è¯
    auth = tweepy.OAuth1UserHandler(API_KEY, API_SECRET, ACCESS_TOKEN, ACCESS_TOKEN_SECRET)
    api = tweepy.API(auth)
    
    # ä¸»å¾ªç¯ï¼šæ¯å°æ—¶è·å–ä¸€æ¬¡æ•°æ®å¹¶å‘å¸ƒæ¨æ–‡
    while True:
        sensor_data = get_sensor_data()
        tweet_text = format_tweet(sensor_data)
        print("Tweet content:\n", tweet_text)
        post_tweet(api, tweet_text)
        # æ¯3600ç§’ï¼ˆ1å°æ—¶ï¼‰å‘å¸ƒä¸€æ¬¡ï¼Œå¯æ ¹æ®éœ€è¦ä¿®æ”¹é—´éš”
        time.sleep(3600)

if __name__ == "__main__":
    main()

										ESP32ä»£ç ä¿®æ”¹
#include <Arduino.h>
#include <WiFi.h>
#include <HTTPClient.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <SdsDustSensor.h>
#include <SPI.h>
#include <SD.h>
#include <time.h> // For NTP time sync

// ========== 1) WiFi Configuration ==========
const char* ssid = "HCSS";          // Your WiFi SSID
const char* password = "123456789"; // Your WiFi Password
const char* serverUrl = "http://192.168.137.1:3000/upload"; // Your server address

// ========== 2) NTP Configuration ==========
const char* ntpServer = "pool.ntp.org";
const long gmtOffset_sec = 8 * 3600;  // UTC+8 for China
const int daylightOffset_sec = 0;     // Typically no DST in China

// ========== 3) OLED Display Configuration ==========
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET   -1
#define SCREEN_ADDRESS 0x3C

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

void setupDisplay() {
  if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
    Serial.println(F("âš ï¸ OLED display initialization failed!"));
    for (;;);
  }
  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);
  display.display();
}

// ========== 4) Serial Definitions ==========
// 4.1) Arduino data serial (Serial2)
#define ARDUINO_RX_PIN 4   // Arduino TX -> ESP32 GPIO4
#define ARDUINO_TX_PIN 17  // Arduino RX -> ESP32 GPIO17
// 4.2) SDS011 sensor serial
#define SDS011_RX_PIN 25   // SDS011 TX -> ESP32 GPIO25
#define SDS011_TX_PIN 26   // SDS011 RX -> ESP32 GPIO26

// ========== 5) Global Variables ==========
// Arduino sensor data (order: MQ-2, CO, NO2, NH3, CO2)
int arduinoValues[5] = {0, 0, 0, 0, 0};
// SDS011 data
float pm25 = 0.0, pm10 = 0.0;

// ========== 6) Display Page Control ==========
int currentPage = 0;
const int totalPages = 2;

// ========== 7) Timers ==========
unsigned long previousDataTime = 0;
const unsigned long dataInterval = 10000; // Refresh data every 10 seconds

unsigned long previousPageTime = 0;
const unsigned long pageInterval = 5000;  // Change display page every 5 seconds

// ========== 8) OLED Display Functions ==========
void displayArduinoData() {
  display.clearDisplay();
  display.setCursor(0, 0);
  // MQ-2: Display raw value (unit depends on calibration, here assume "ppm")
  display.print("MQ-2: ");
  display.print(arduinoValues[0]);
  display.print(" ppm");

  // CO: Multiply by 0.1, unit: ppm
  display.setCursor(0, 10);
  display.print("CO: ");
  display.print(arduinoValues[1] * 0.1);
  display.print(" ppm");

  // NO2: Multiply by 0.1, unit: ppb (assuming front-end uses ppb for NO2)
  display.setCursor(0, 20);
  display.print("NO2: ");
  display.print(arduinoValues[2] * 0.1);
  display.print(" ppb");

  // NH3: Display raw value, unit: ppm (adjust if needed)
  display.setCursor(0, 30);
  display.print("NH3: ");
  display.print(arduinoValues[3]);
  display.print(" ppb");

  // CO2: Divide by 2, unit: ppm
  display.setCursor(0, 40);
  display.print("CO2: ");
  display.print(arduinoValues[4] / 2);
  display.print(" ppm");

  display.display();
}

void displaySDS011Data() {
  display.clearDisplay();
  display.setCursor(0, 0);
  display.print("PM2.5: ");
  display.print(pm25, 1);
  display.print(" ug/m3");

  display.setCursor(0, 10);
  display.print("PM10: ");
  display.print(pm10, 1);
  display.print(" ug/m3");

  display.display();
}

void updateDisplay() {
  if (currentPage == 0) {
    displayArduinoData();
  } else {
    displaySDS011Data();
  }
}

// ========== 9) SDS011 Sensor Object ==========
HardwareSerial sdsSerial(1);
SdsDustSensor sds011(sdsSerial);

// ========== 10) WiFi Data Upload Function ==========
void sendToServer() {
  // Construct JSON data with modifications:
  // CO is multiplied by 0.1, NO2 by 0.1, CO2 is divided by 2
  String jsonData = "{";
  jsonData += "\"mq2\":"  + String(arduinoValues[0]) + ",";
  jsonData += "\"co\":"   + String(arduinoValues[1] * 0.1) + ",";
  jsonData += "\"no2\":"  + String(arduinoValues[2] * 0.1) + ",";
  jsonData += "\"nh3\":"  + String(arduinoValues[3]) + ",";
  jsonData += "\"co2\":"  + String(arduinoValues[4] / 2) + ",";
  jsonData += "\"pm25\":" + String(pm25, 1) + ",";
  jsonData += "\"pm10\":" + String(pm10, 1);
  jsonData += "}";

  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;
    http.begin(serverUrl);
    http.addHeader("Content-Type", "application/json");

    Serial.print("ğŸ“¤ Sending JSON: ");
    Serial.println(jsonData);

    int httpResponseCode = http.POST(jsonData);
    Serial.print("ğŸ“¡ HTTP Response Code: ");
    Serial.println(httpResponseCode);

    http.end();
  } else {
    Serial.println("âŒ WiFi not connected!");
  }
}

// ========== 11) SD Card Setup ==========
#define SD_CS_PIN 5
bool sdInitialized = false;

// ========== 12) Buzzer Alarm Configuration ==========
#define BUZZER_PIN 16 // Active buzzer on GPIO16, HIGH level triggers sound

// Thresholds (units as per sensor calibration)
const int THRESHOLD_MQ2    = 400;
const int THRESHOLD_CO     = 500;
const int THRESHOLD_NO2    = 350;
const int THRESHOLD_NH3    = 300;
const int THRESHOLD_CO2    = 800;
const float THRESHOLD_PM25 = 10.0;
const float THRESHOLD_PM10 = 20.0;

bool needAlarm = false;

// ========== 13) NTP Time Synchronization ==========
void setupTime() {
  configTime(gmtOffset_sec, daylightOffset_sec, ntpServer);
  Serial.print("Synchronizing network time");
  while (true) {
    time_t now = time(nullptr);
    if (now > 8 * 3600) {  // Simple check: time > 1970-01-01
      Serial.println("\nâœ… Time synchronized!");
      break;
    }
    Serial.print(".");
    delay(1000);
  }
}

// ========== 14) SD Card Write Function ==========
void writeDataToSD() {
  if (!sdInitialized) return;

  File file = SD.open("/sensor_data.csv", FILE_APPEND);
  if (!file) {
    Serial.println("âŒ Unable to open sensor_data.csv for writing!");
    return;
  }

  // Write header if file is empty
  if (file.size() == 0) {
    file.println("MQ2,CO,NO2,NH3,CO2,PM2.5,PM10,Time");
  }

  // Get current local time
  time_t now = time(nullptr);
  struct tm* timeinfo = localtime(&now);
  char timeString[25];
  strftime(timeString, sizeof(timeString), "%F %T", timeinfo);

  // Write CSV line: note that modifications are done only for display/server
  // Here we log the raw sensor values. You may log the adjusted values if needed.
  file.print(arduinoValues[0]); file.print(",");
  file.print(arduinoValues[1]); file.print(",");
  file.print(arduinoValues[2]); file.print(",");
  file.print(arduinoValues[3]); file.print(",");
  file.print(arduinoValues[4]); file.print(",");
  file.print(pm25, 1);          file.print(",");
  file.print(pm10, 1);          file.print(",");
  file.println(timeString);

  file.close();
  Serial.println("âœ… Data written to sensor_data.csv");
}

// ========== 15) setup() Function ==========
void setup() {
  Serial.begin(115200);
  Serial.println("===== ESP32: Starting =====");

  // 1) Initialize OLED display
  setupDisplay();

  // 2) Connect to WiFi
  Serial.print("Connecting to WiFi: ");
  Serial.println(ssid);
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nâœ… WiFi Connected!");
  Serial.print("ğŸ“¡ IP Address: ");
  Serial.println(WiFi.localIP());

  // 3) Synchronize NTP time
  setupTime();

  // 4) Initialize serial ports
  // 4.1) Arduino data serial (Serial2)
  Serial2.begin(115200, SERIAL_8N1, ARDUINO_RX_PIN, ARDUINO_TX_PIN);
  Serial.println("Serial2 (Arduino) initialized.");

  // 4.2) SDS011 serial (HardwareSerial(1))
  sdsSerial.begin(9600, SERIAL_8N1, SDS011_RX_PIN, SDS011_TX_PIN);
  Serial.println("SDS011 serial initialized.");

  // 5) Set SDS011 to active reporting mode
  sds011.setActiveReportingMode();

  // 6) Initialize timers
  previousDataTime = millis();
  previousPageTime = millis();

  // 7) Initialize buzzer pin
  pinMode(BUZZER_PIN, OUTPUT);
  digitalWrite(BUZZER_PIN, LOW);

  // 8) Initialize SD card
  Serial.println("Initializing SD card...");
  if (!SD.begin(SD_CS_PIN)) {
    Serial.println("âš ï¸ SD card initialization failed. File logging disabled!");
    sdInitialized = false;
  } else {
    Serial.println("âœ… SD card initialized.");
    sdInitialized = true;
  }

  // Display the first page (Arduino data)
  currentPage = 0;
  updateDisplay();
}

// ========== 16) loop() Function ==========
void loop() {
  unsigned long currentMillis = millis();

  // A. Data refresh every 10 seconds
  if (currentMillis - previousDataTime >= dataInterval) {
    previousDataTime = currentMillis;

    // 1) Read SDS011 data (PM2.5 and PM10)
    PmResult pm = sds011.queryPm();
    if (pm.isOk()) {
      pm25 = pm.pm25;
      pm10 = pm.pm10;
      Serial.printf("SDS011: PM2.5=%.1f, PM10=%.1f\n", pm25, pm10);
    } else {
      Serial.println("SDS011 data read failed.");
    }

    // 2) Read Arduino data from Serial2
    if (Serial2.available()) {
      String data = Serial2.readStringUntil('\n');
      Serial.println("Received Arduino data: " + data);
      int values[5];
      int index = 0;
      char *ptr = strtok((char*)data.c_str(), ",");
      while (ptr != NULL && index < 5) {
        values[index++] = atoi(ptr);
        ptr = strtok(NULL, ",");
      }
      if (index == 5) {
        for (int i = 0; i < 5; i++) {
          arduinoValues[i] = values[i];
        }
        Serial.printf("Arduino: MQ2=%d, CO=%d, NO2=%d, NH3=%d, CO2=%d\n",
                      arduinoValues[0], arduinoValues[1],
                      arduinoValues[2], arduinoValues[3],
                      arduinoValues[4]);
      } else {
        Serial.println("Arduino data parse error!");
      }
    } else {
      Serial.println("No Arduino data received.");
    }

    // 3) Update OLED display to show Arduino data
    currentPage = 0;
    updateDisplay();
    previousPageTime = currentMillis;

    // 4) Send data to server (with modified values)
    sendToServer();

    // 5) Write data to SD card (raw values, with timestamp)
    writeDataToSD();

    // 6) Check for alarm condition
    needAlarm = false;
    if (arduinoValues[0] > THRESHOLD_MQ2) needAlarm = true;
    if (arduinoValues[1] > THRESHOLD_CO)  needAlarm = true;
    if (arduinoValues[2] > THRESHOLD_NO2) needAlarm = true;
    if (arduinoValues[3] > THRESHOLD_NH3) needAlarm = true;
    if (arduinoValues[4] > THRESHOLD_CO2) needAlarm = true;
    if (pm25 > THRESHOLD_PM25)            needAlarm = true;
    if (pm10 > THRESHOLD_PM10)            needAlarm = true;

    if (needAlarm) {
      Serial.println("âš ï¸ Sensor values exceed thresholds, triggering alarm!");
      digitalWrite(BUZZER_PIN, HIGH);
    } else {
      Serial.println("Sensor values are normal, no alarm.");
      digitalWrite(BUZZER_PIN, LOW);
    }
  }

  // B. Page switching every 5 seconds
  if (currentMillis - previousPageTime >= pageInterval) {
    previousPageTime = currentMillis;
    currentPage = (currentPage + 1) % totalPages;
    updateDisplay();
  }

  delay(100);
}
                                                                       APP.vueæ›´æ–°
<template>
  <div id="app">
    <nav style="padding: 10px; background: #eee;">
      <router-link to="/">Home</router-link>
    </nav>
    <!-- Router view, if you have multiple pages -->
    <router-view />

    <!-- Single unified AirQualityDashboard component -->
    <AirQualityDashboard />
  </div>
</template>

<script>
import AirQualityDashboard from './components/AirQualityDashboard.vue'
// You can remove or comment out the import for SensorData.vue
// import SensorData from './components/SensorData.vue'

export default {
  name: 'App',
  components: {
    AirQualityDashboard
    // SensorData
  }
}
</script>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  text-align: center;
  color: #2c3e50;
  margin-top: 0;
}
nav a {
  margin: 0 10px;
  font-weight: bold;
  color: #2c3e50;
}
nav a.router-link-exact-active {
  color: #42b983;
}
</style>

						AirqualityDashboard.vueæ›´æ–°
<template>
  <div class="dashboard-container">
    <!-- Left side: chart -->
    <div class="left-section">
      <line-chart :chart-data="chartData" :options="chartOptions" />
    </div>

    <!-- Right side: sensor data + WHO table -->
    <div class="right-section">
      <div class="sensor-section">
        <h3>Current Sensor Data</h3>
        <table class="sensor-table">
          <tbody>
            <tr><td>Combustible Gas:</td><td>{{ sensorData.mq2 }} ppm</td></tr>
            <tr><td>CO:</td><td>{{ sensorData.co }} ppm</td></tr>
            <tr><td>NO2:</td><td>{{ sensorData.no2 }} ppb</td></tr>
            <tr><td>NH3:</td><td>{{ sensorData.nh3 }} ppb</td></tr>
            <tr><td>CO2:</td><td>{{ sensorData.co2 }} ppm</td></tr>
            <tr><td>PM2.5:</td><td>{{ sensorData.pm25 }} Âµg/mÂ³</td></tr>
            <tr><td>PM10:</td><td>{{ sensorData.pm10 }} Âµg/mÂ³</td></tr>
            <tr v-if="sensorData.timestamp">
              <td>Time:</td>
              <td>{{ new Date(sensorData.timestamp).toLocaleString() }}</td>
            </tr>
          </tbody>
        </table>
        <button @click="fetchSensorData">Refresh Data</button>
      </div>

      <div class="who-section">
        <h3>WHO Reference Data</h3>
        <table>
          <thead>
            <tr>
              <th>Parameter</th>
              <th>WHO Standard</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(item, idx) in whoData" :key="idx">
              <td>{{ item.param }}</td>
              <td>{{ item.standard }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</template>

<script>
import axios from 'axios'
import { Line } from 'vue-chartjs'
import {
  Chart as ChartJS,
  Title,
  Tooltip,
  Legend,
  LineElement,
  PointElement,
  CategoryScale,
  LinearScale
} from 'chart.js'

// Register Chart.js components
ChartJS.register(Title, Tooltip, Legend, LineElement, PointElement, CategoryScale, LinearScale)

// A simple LineChart component for rendering
const LineChart = {
  extends: Line,
  props: ['chartData', 'options'],
  mounted() {
    this.renderChart(this.chartData, this.options)
  },
  watch: {
    chartData(newVal) {
      this.renderChart(newVal, this.options)
    }
  }
}

export default {
  name: 'AirQualityDashboard',
  components: {
    'line-chart': LineChart
  },
  data() {
    return {
      // Chart data
      chartData: {
        labels: [],
        datasets: [
          {
            label: 'PM2.5 (Âµg/mÂ³)',
            borderColor: 'rgba(54, 162, 235, 1)',
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            fill: false,
            data: []
          },
          {
            label: 'PM10 (Âµg/mÂ³)',
            borderColor: 'rgba(255, 99, 132, 1)',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            fill: false,
            data: []
          }
        ]
      },
      chartOptions: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            title: { display: true, text: 'Time' }
          },
          y: {
            title: { display: true, text: 'Concentration' }
          }
        }
      },
      // WHO reference data
      whoData: [
      { param: 'Combustible Gas', standard: 'Recommended < 300 ppm' },
      { param: 'CO',    standard: '15 min: 87 ppm, 1 hr: 30 ppm, 8 hr: 9 ppm, 24 hr: 6 ppm' },
      { param: 'NO2',   standard: '1h: ~106 ppb, Annual: ~21 ppb' },
      { param: 'NH3',   standard: 'recommended < 1000 ppb' },
      { param: 'CO2',   standard: 'Recommended < 1000 ppm' },
      { param: 'PM2.5', standard: '24h: 25 Âµg/mÂ³, Annual: 10 Âµg/mÂ³' },
      { param: 'PM10',  standard: '24h: 50 Âµg/mÂ³, Annual: 20 Âµg/mÂ³' }

      ],
      // Current sensor data
      sensorData: {
        mq2: 0,
        co: 0,
        no2: 0,
        nh3: 0,
        co2: 0,
        pm25: 0,
        pm10: 0,
        timestamp: ''
      }
    }
  },
  methods: {
    fetchSensorData() {
      axios.get('http://192.168.137.1:3000/data') // Use your local IP if needed
        .then(res => {
          const data = res.data
          this.sensorData = data

          // Add a new time label
          const label = data.timestamp 
            ? new Date(data.timestamp).toLocaleTimeString() 
            : new Date().toLocaleTimeString()

          // Push new PM2.5, PM10 data
          this.chartData.labels.push(label)
          this.chartData.datasets[0].data.push(data.pm25) // PM2.5
          this.chartData.datasets[1].data.push(data.pm10) // PM10

          // Keep only the last 10 data points
          if (this.chartData.labels.length > 10) {
            this.chartData.labels.shift()
            this.chartData.datasets.forEach(ds => ds.data.shift())
          }
        })
        .catch(err => {
          console.error('Error fetching sensor data:', err)
        })
    },
    startTimer() {
      // Fetch data every 5 seconds
      setInterval(() => {
        this.fetchSensorData()
      }, 5000)
    }
  },
  mounted() {
    // Fetch data once on component mount
    this.fetchSensorData()
    // Start auto-refresh
    this.startTimer()
  }
}
</script>

<style scoped>
.dashboard-container {
  display: flex;
  gap: 20px;
  /* set a height if needed */
  min-height: 400px;
}

/* Left side: chart */
.left-section {
  flex: 1;
  border: 1px solid #ccc;
  position: relative;
}

/* Right side: sensor data + WHO table in vertical layout */
.right-section {
  width: 350px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* Sensor data table */
.sensor-section {
  border: 1px solid #ccc;
  padding: 10px;
}

.sensor-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 10px;
}
.sensor-table td {
  padding: 4px 8px;
}

/* WHO reference table */
.who-section {
  border: 1px solid #ccc;
  padding: 10px;
}
.who-section table {
  width: 100%;
  border-collapse: collapse;
}
.who-section th, .who-section td {
  border: 1px solid #aaa;
  padding: 6px;
  text-align: left;
}
</style>
									ESP32ä»£ç ä¿®æ”¹
#include <Arduino.h>
#include <WiFi.h>
#include <HTTPClient.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <SdsDustSensor.h>
#include <SPI.h>
#include <SD.h>
#include <time.h> // ç”¨äº NTP æ—¶é—´åŒæ­¥

// ========== 1) WiFi é…ç½® ==========
const char* ssid = "HCSS";          // ä½ çš„ WiFi åç§°
const char* password = "123456789"; // ä½ çš„ WiFi å¯†ç 
const char* serverUrl = "http://192.168.137.1:3000/upload"; // ä½ çš„æœåŠ¡å™¨åœ°å€

// ========== 2) NTP é…ç½® ==========
const char* ntpServer = "pool.ntp.org"; // NTP æœåŠ¡å™¨
const long gmtOffset_sec = 8 * 3600;      // UTC+8 (ä¸­å›½)
const int daylightOffset_sec = 0;         // æ— å¤ä»¤æ—¶

// ========== 3) OLED å±å¹•é…ç½® ==========
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET   -1
#define SCREEN_ADDRESS 0x3C

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

void setupDisplay() {
  if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
    Serial.println(F(" OLED æ˜¾ç¤ºåˆå§‹åŒ–å¤±è´¥!"));
    for (;;);
  }
  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);
  display.display();
}

// ========== 4) ä¸²å£å®šä¹‰ ==========
#define ARDUINO_RX_PIN 4   // Arduino TX -> ESP32 GPIO4
#define ARDUINO_TX_PIN 17  // Arduino RX -> ESP32 GPIO17
#define SDS011_RX_PIN 25   // SDS011 TX -> ESP32 GPIO25
#define SDS011_TX_PIN 26   // SDS011 RX -> ESP32 GPIO26

// ========== 5) å…¨å±€å˜é‡ ==========
int arduinoValues[5] = {0, 0, 0, 0, 0}; // ä¼ æ„Ÿå™¨æ•°æ®ï¼šMQ-2, CO, NO2, NH3, CO2
float pm25 = 0.0, pm10 = 0.0;           // SDS011 æ•°æ®

// ========== 6) å®šæ—¶å™¨ ==========
unsigned long previousDataTime = 0;
const unsigned long dataInterval = 10000; // æ¯ 10 ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®
unsigned long previousPageTime = 0;
const unsigned long pageInterval = 5000;  // æ¯ 5 ç§’åˆ‡æ¢ä¸€æ¬¡æ˜¾ç¤ºé¡µé¢

// ========== 7) OLED æ˜¾ç¤ºå‡½æ•° ==========
void displayArduinoData() {
  display.clearDisplay();

  display.setCursor(0, 0);
  display.print("MQ-2: ");
  display.print(arduinoValues[0]);
  display.print(" ppm");

  display.setCursor(0, 10);
  display.print("CO: ");
  display.print(arduinoValues[1]);
  display.print(" ppm");

  display.setCursor(0, 20);
  display.print("NO2: ");
  display.print(arduinoValues[2]);
  display.print(" ppm");

  display.setCursor(0, 30);
  display.print("NH3: ");
  display.print(arduinoValues[3]);
  display.print(" ppm");

  display.setCursor(0, 40);
  display.print("CO2: ");
  display.print(arduinoValues[4]);
  display.print(" ppm");

  display.display();
}

void displaySDS011Data() {
  display.clearDisplay();

  display.setCursor(0, 0);
  display.print("PM2.5: ");
  display.print(pm25, 1);
  display.print(" ug/m3");

  display.setCursor(0, 10);
  display.print("PM10: ");
  display.print(pm10, 1);
  display.print(" ug/m3");

  display.display();
}

void updateDisplay() {
  // æœ¬ä¾‹ä¸­åªæ˜¾ç¤º Arduino æ•°æ®
  displayArduinoData();
}

// ========== 8) SDS011 ä¼ æ„Ÿå™¨å¯¹è±¡ ==========
HardwareSerial sdsSerial(1);
SdsDustSensor sds011(sdsSerial);

// ========== 9) WiFi æ•°æ®ä¸Šä¼ å‡½æ•° ==========
void sendToServer() {
  // æ„é€  JSON æ•°æ® (æ­¤å¤„å·²åº”ç”¨å‰é¢æ ¡æ­£çš„é€»è¾‘)
  String jsonData = "{";
  jsonData += "\"mq2\":"  + String(arduinoValues[0]) + ",";
  jsonData += "\"co\":"   + String(arduinoValues[1] * 0.1) + ",";
  jsonData += "\"no2\":"  + String(arduinoValues[2] * 0.1) + ",";
  jsonData += "\"nh3\":"  + String(arduinoValues[3]) + ",";
  jsonData += "\"co2\":"  + String(arduinoValues[4] / 2) + ",";
  jsonData += "\"pm25\":" + String(pm25, 1) + ",";
  jsonData += "\"pm10\":" + String(pm10, 1);
  jsonData += "}";

  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;
    http.begin(serverUrl);
    http.addHeader("Content-Type", "application/json");

    Serial.print(" Sending JSON: ");
    Serial.println(jsonData);

    int httpResponseCode = http.POST(jsonData);
    Serial.print(" HTTP Response Code: ");
    Serial.println(httpResponseCode);

    http.end();
  } else {
    Serial.println(" WiFi not connected!");
  }
}

// ========== 10) SD å¡é…ç½® ==========
#define SD_CS_PIN 5
bool sdInitialized = false;

// ========== 11) èœ‚é¸£å™¨é…ç½® ==========
#define BUZZER_PIN 16  // èœ‚é¸£å™¨è¿æ¥åˆ° GPIO16

// è®¾ç½®æŠ¥è­¦é˜ˆå€¼ï¼ˆå•ä½ç”±å„ä¼ æ„Ÿå™¨æ ¡å‡†åç¡®å®šï¼‰
const int THRESHOLD_MQ2    = 600;
const int THRESHOLD_CO     = 1000;
const int THRESHOLD_NO2    = 1500;
const int THRESHOLD_NH3    = 1200;
const int THRESHOLD_CO2    = 1200;
const float THRESHOLD_PM25 = 25.0;
const float THRESHOLD_PM10 = 50.0;

bool needAlarm = false;

// ========== 12) NTP æ—¶é—´åŒæ­¥ ==========
void setupTime() {
  configTime(gmtOffset_sec, daylightOffset_sec, ntpServer);
  Serial.print("æ­£åœ¨åŒæ­¥ç½‘ç»œæ—¶é—´");
  while (true) {
    time_t now = time(nullptr);
    if (now > 8 * 3600) {  // ç®€å•åˆ¤æ–­æ˜¯å¦åŒæ­¥æˆåŠŸ
      Serial.println("\n æ—¶é—´åŒæ­¥æˆåŠŸ!");
      break;
    }
    Serial.print(".");
    delay(1000);
  }
}

// ========== 13) SD å¡å†™å…¥å‡½æ•° ==========
void writeDataToSD() {
  if (!sdInitialized) return;

  File file = SD.open("/sensor_data.csv", FILE_APPEND);
  if (!file) {
    Serial.println(" æ— æ³•æ‰“å¼€ sensor_data.csv è¿›è¡Œå†™å…¥!");
    return;
  }

  if (file.size() == 0) {
    file.println("MQ2,CO,NO2,NH3,CO2,PM2.5,PM10,Time");
  }

  time_t now = time(nullptr);
  struct tm* timeinfo = localtime(&now);
  char timeString[25];
  strftime(timeString, sizeof(timeString), "%F %T", timeinfo);

  file.print(arduinoValues[0]); file.print(",");
  file.print(arduinoValues[1]); file.print(",");
  file.print(arduinoValues[2]); file.print(",");
  file.print(arduinoValues[3]); file.print(",");
  file.print(arduinoValues[4]); file.print(",");
  file.print(pm25, 1);          file.print(",");
  file.print(pm10, 1);          file.print(",");
  file.println(timeString);

  file.close();
  Serial.println(" æ•°æ®å·²å†™å…¥ sensor_data.csv");
}

// ========== 14) setup() å‡½æ•° ==========
void setup() {
  Serial.begin(115200);
  Serial.println("===== ESP32: Starting =====");

  // åˆå§‹åŒ– OLED æ˜¾ç¤ºå™¨
  setupDisplay();

  // è¿æ¥ WiFi
  Serial.print("æ­£åœ¨è¿æ¥ WiFi: ");
  Serial.println(ssid);
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\n WiFi å·²è¿æ¥!");
  Serial.print(" IP åœ°å€: ");
  Serial.println(WiFi.localIP());

  // åŒæ­¥ NTP æ—¶é—´
  setupTime();

  // åˆå§‹åŒ–ä¸²å£
  Serial2.begin(115200, SERIAL_8N1, ARDUINO_RX_PIN, ARDUINO_TX_PIN);
  Serial.println("Serial2 (Arduino) å·²åˆå§‹åŒ–.");
  sdsSerial.begin(9600, SERIAL_8N1, SDS011_RX_PIN, SDS011_TX_PIN);
  Serial.println("SDS011 ä¸²å£å·²åˆå§‹åŒ–.");

  // è®¾ç½® SDS011 ä¸ºä¸»åŠ¨ä¸ŠæŠ¥æ¨¡å¼
  sds011.setActiveReportingMode();

  previousDataTime = millis();
  previousPageTime = millis();

  // åˆå§‹åŒ–èœ‚é¸£å™¨å¼•è„šï¼ˆèœ‚é¸£å™¨ä¸ºè¢«åŠ¨èœ‚é¸£å™¨ï¼Œä½¿ç”¨ tone() è¿›è¡Œæ§åˆ¶ï¼‰
  pinMode(BUZZER_PIN, OUTPUT);
  // åˆå§‹åŒ– SD å¡
  Serial.println("æ­£åœ¨åˆå§‹åŒ– SD å¡...");
  if (!SD.begin(SD_CS_PIN)) {
    Serial.println(" SD å¡åˆå§‹åŒ–å¤±è´¥ï¼Œæ— æ³•å†™å…¥æ–‡ä»¶!");
    sdInitialized = false;
  } else {
    Serial.println(" SD å¡åˆå§‹åŒ–æˆåŠŸ.");
    sdInitialized = true;
  }

  // åˆæ¬¡æ›´æ–°æ˜¾ç¤º
  updateDisplay();
}

// ========== 15) loop() å‡½æ•° ==========
void loop() {
  unsigned long currentMillis = millis();

  // æ¯ 10 ç§’åˆ·æ–°æ•°æ®
  if (currentMillis - previousDataTime >= dataInterval) {
    previousDataTime = currentMillis;

    // 1) è¯»å– SDS011 æ•°æ®ï¼ˆPM2.5 å’Œ PM10ï¼‰
    PmResult pm = sds011.queryPm();
    if (pm.isOk()) {
      pm25 = pm.pm25;
      pm10 = pm.pm10;
      Serial.printf("SDS011: PM2.5=%.1f, PM10=%.1f\n", pm25, pm10);
    } else {
      Serial.println("SDS011 æ•°æ®è¯»å–å¤±è´¥.");
    }

    // 2) è¯»å– Arduino æ•°æ®ï¼ˆä» Serial2 è·å–ï¼‰
    if (Serial2.available()) {
      String data = Serial2.readStringUntil('\n');
      Serial.println("æ”¶åˆ° Arduino æ•°æ®: " + data);
      int values[5];
      int index = 0;
      char *ptr = strtok((char*)data.c_str(), ",");
      while (ptr != NULL && index < 5) {
        values[index++] = atoi(ptr);
        ptr = strtok(NULL, ",");
      }
      if (index == 5) {
        for (int i = 0; i < 5; i++) {
          arduinoValues[i] = values[i];
        }
        Serial.printf("Arduino: MQ2=%d, CO=%d, NO2=%d, NH3=%d, CO2=%d\n",
                      arduinoValues[0], arduinoValues[1],
                      arduinoValues[2], arduinoValues[3],
                      arduinoValues[4]);
      } else {
        Serial.println("Arduino æ•°æ®è§£æé”™è¯¯!");
      }
    } else {
      Serial.println("æœªæ”¶åˆ° Arduino æ•°æ®.");
    }

    // 3) æ›´æ–° OLED æ˜¾ç¤º (ä»…æ˜¾ç¤º Arduino æ•°æ®)
    updateDisplay();
    previousPageTime = currentMillis;

    // 4) ä¸Šä¼ æ•°æ®åˆ°æœåŠ¡å™¨
    sendToServer();

    // 5) å†™å…¥ SD å¡ï¼ˆé™„åŠ æ—¶é—´æˆ³ï¼‰
    writeDataToSD();

    // 6) åˆ¤æ–­æ˜¯å¦è¶…å‡ºé˜ˆå€¼ï¼Œå¹¶è§¦å‘èœ‚é¸£å™¨
    needAlarm = false;
    if (arduinoValues[0] > THRESHOLD_MQ2) needAlarm = true; // MQ2
    if (arduinoValues[1] > THRESHOLD_CO)  needAlarm = true; // CO
    if (arduinoValues[2] > THRESHOLD_NO2) needAlarm = true; // NO2
    if (arduinoValues[3] > THRESHOLD_NH3) needAlarm = true; // NH3
    if (arduinoValues[4] > THRESHOLD_CO2) needAlarm = true; // CO2
    if (pm25 > THRESHOLD_PM25)            needAlarm = true; // PM2.5
    if (pm10 > THRESHOLD_PM10)            needAlarm = true; // PM10

    if (needAlarm) {
      Serial.println(" Sensor values exceed thresholds, triggering alarm beep!");
      // ä½¿ç”¨ tone() ç”Ÿæˆ 4000Hzã€300ms çš„èœ‚é¸£å£°
      tone(BUZZER_PIN, 4000, 300);
    } else {
      // åœæ­¢èœ‚é¸£å™¨å‘å£°
      noTone(BUZZER_PIN);
      Serial.println("Sensor values are normal, no alarm.");
    }
  }

  // æ­¤å¤„å¯æ·»åŠ å…¶ä»–å‘¨æœŸæ€§ä»»åŠ¡
  delay(100);
}
								Air Quality Dashboardæ›´æ–°
<template>
    <div class="dashboard-container">
        <div class="top-row">
            <div class="who-section">
                <h3>WHO Reference Data</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>WHO Standard</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, idx) in whoData" :key="idx">
                            <td>{{ item.param }}</td>
                            <td>{{ item.standard }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="right-section">
                <div class="sensor-section">
                    <h3>Current Sensor Data</h3>
                    <table class="sensor-table">
                        <tbody>
                            <tr><td>Combustible Gas:</td><td>{{ sensorData.mq2 }} ppm</td></tr>
                            <tr><td>CO:</td><td>{{ sensorData.co }} ppm</td></tr>
                            <tr><td>NO2:</td><td>{{ sensorData.no2 }} ppb</td></tr>
                            <tr><td>NH3:</td><td>{{ sensorData.nh3 }} ppb</td></tr>
                            <tr><td>CO2:</td><td>{{ sensorData.co2 }} ppm</td></tr>
                            <tr><td>PM2.5:</td><td>{{ sensorData.pm25 }} Âµg/mÂ³</td></tr>
                            <tr><td>PM10:</td><td>{{ sensorData.pm10 }} Âµg/mÂ³</td></tr>
                            <tr v-if="sensorData.timestamp">
                                <td>Time:</td>
                                <td>{{ new Date(sensorData.timestamp).toLocaleString() }}</td>
                            </tr>
                        </tbody>
                    </table>
                    <button class="refresh-button" @click="fetchSensorData">Refresh Data</button>
                </div>
            </div>
        </div>
        <div class="chart-section">
            <line-chart :chart-data="chartData" :options="chartOptions"/>
        </div>
    </div>
</template>

<script>
import axios from 'axios'
import LineChart from './lineChart.vue'
export default {
    name: 'AirQualityDashboard',
    components: {
        'line-chart': LineChart
    },
    data() {
        return {
            chartData: {
                labels: [],
                datasets: [
                    { label: 'PM2.5 (Âµg/mÂ³)',  borderColor: '#36A2EB', data: [] },
                    { label: 'PM10 (Âµg/mÂ³)',   borderColor: '#FF6384', data: [] },
                    { label: 'CO (ppm)',      borderColor: '#4BC0C0', data: [] },
                    { label: 'NO2 (ppb)',     borderColor: '#FFCE56', data: [] },
                    { label: 'NH3 (ppb)',     borderColor: '#556270', data: [] },
                    { label: 'MQ2 (ppm)',    borderColor: '#C779D0', data: [] },
                    { label: 'CO2 (ppm)',       borderColor: '#2ECC71', data: [] }
                ]
            },
            chartOptions: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: { display: true, text: 'Time' }
                    },
                    y: {
                        title: { display: true, text: 'Concentration' }
                    }
                }
            },
            whoData: [
                { param: 'Combustible Gas', standard: 'Recommended < 300 ppm' },
                { param: 'CO',    standard: '15 min: 87 ppm, 1 hr: 30 ppm, 8 hr: 9 ppm, 24 hr: 6 ppm' },
                { param: 'NO2',   standard: '1h: ~106 ppb, Annual: ~21 ppb' },
                { param: 'NH3',   standard: 'recommended < 1000 ppb' },
                { param: 'CO2',   standard: 'Recommended < 1000 ppm' },
                { param: 'PM2.5', standard: '24h: 25 Âµg/mÂ³, Annual: 10 Âµg/mÂ³' },
                { param: 'PM10',  standard: '24h: 50 Âµg/mÂ³, Annual: 20 Âµg/mÂ³' }
            ],
            sensorData: {
                mq2: 0,
                co: 0,
                no2: 0,
                nh3: 0,
                co2: 0,
                pm25: 0,
                pm10: 0,
                timestamp: ''
            }
        }
    },
    methods: {
        fetchSensorData() {
            axios.get('http://192.168.137.1:3000/data')
              .then(res => {
                    const data = res.data
                    this.sensorData = data
                    const label = data.timestamp ? new Date(data.timestamp).toLocaleTimeString() : new Date().toLocaleTimeString()
                    this.chartData.labels.push(label)
                    this.chartData.datasets[0].data.push(data.pm25)
                    this.chartData.datasets[1].data.push(data.pm10)
                    this.chartData.datasets[2].data.push(data.co)
                    this.chartData.datasets[3].data.push(data.no2)
                    this.chartData.datasets[4].data.push(data.nh3)
                    this.chartData.datasets[5].data.push(data.mq2)
                    this.chartData.datasets[6].data.push(data.co2)

                    if (this.chartData.labels.length > 10) {
                        this.chartData.labels.shift()
                        this.chartData.datasets.forEach(ds => ds.data.shift())
                    }
                })
              .catch(err => {
                    console.error('Error fetching sensor data:', err)
                })
        },
        startTimer() {
            setInterval(() => {
                this.fetchSensorData()
            }, 10000)
        }
    },
    mounted() {
        this.fetchSensorData()
        this.startTimer()
    }
}
</script>

<style scoped>
.dashboard-container {
    font-size: 32px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    height: 500px;
}

.top-row {
    display: flex;
    gap: 20px;
}

.chart-section {
    flex: 1;
    border: 1px solid #ccc;
    position: relative;
}

.who-section {
    flex: 1;
    width: 300px;
    border: 1px solid #ccc;
    padding: 10px;
}

.who-section table {
    width: 100%;
    border-collapse: collapse;
}

.who-section th, .who-section td {
    border: 1px solid #aaa;
    padding: 6px;
    text-align: left;
}

.right-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.sensor-section {
    height: 100%;
    border: 1px solid #ccc;
    padding: 10px;
}

.sensor-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 10px;
}

.sensor-table td {
    padding: 4px 8px;
}

.buttontest {
    font-size: 20px;
    padding: 10px 20px;
    margin-top: 20px;
    cursor: pointer;
}
.refresh-button {
    background-color: #007BFF;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.refresh-button:hover {
    background-color: #0056b3;
}
</style>    
							line chart.vue
<template>
  <div ref="chartRef" style="width: 100%; height: 400px;"></div>
</template>

<script>
import { markRaw } from 'vue';
import * as echarts from 'echarts';

export default {
  props: {
    chartData: {
      type: Object,
      required: true
    },
    options: {
      type: Object,
      required: true
    },
    test:{
      type:String
    }
  },
  data() {
    return {
      myChart: null
    };
  },
  mounted() {
    this.initChart();
  },
  watch: {
    chartData: {
      handler() {
        this.updateChart();
      },
      deep: true
    },
    options: {
      handler() {
        this.updateChart();
      },
      deep: true
    }
  },
  methods: {
    initChart() {
      const chartRef = this.$refs.chartRef;
      this.myChart = markRaw(echarts.init(chartRef));
      const option = this.generateChartOption();  
      console.log(option);
      
      this.myChart.setOption(option);
    },
    updateChart() {
      if (this.myChart) {
        const option = this.generateChartOption();
        this.myChart.setOption(option, true);
      }
    },
    generateChartOption() {
      return {
        tooltip: {
          trigger: 'axis'
        },
        legend: {
          data: this.chartData.datasets.map(dataset => dataset.label)
        },
        xAxis: {
          type: 'category',
          data: this.chartData.labels,
          name: this.options.scales.x.title.text
        },
        yAxis: {
          type: 'value',
          name: this.options.scales.y.title.text
        },
        series: this.chartData.datasets.map(dataset => ({
          name: dataset.label,
          type: 'bar',
          data: dataset.data,
          lineStyle: {
            color: dataset.borderColor
          },
          itemStyle: {
            color: dataset.borderColor
          },
          areaStyle: {
            color: dataset.backgroundColor
          },
          fill: dataset.fill
        }))
      };
    }
  }
};
</script>    
										APP.vueæ›´æ–°
<template>
  <div id="app">
    <!-- ä¸‹æ–¹æ’å…¥æˆ‘ä»¬çš„ AirQualityDashboard -->
    <AirQualityDashboard />
  </div>
</template>

<script>
import AirQualityDashboard from './components/AirQualityDashboard.vue'

export default {
  name: 'App',
  components: {
    AirQualityDashboard
  }
}
</script>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  text-align: center;
  color: #2c3e50;
  margin-top: 0;
}
nav a {
  margin: 0 10px;
  font-weight: bold;
  color: #2c3e50;
}
nav a.router-link-exact-active {
  color: #42b983;
}
</style>
							ESP32ä»£ç æ›´æ–°
#include <Arduino.h>
#include <WiFi.h>
#include <HTTPClient.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <SdsDustSensor.h>
#include <SPI.h>
#include <SD.h>
#include <time.h> // ç”¨äº NTP æ—¶é—´åŒæ­¥

// ========== 1) WiFi é…ç½® ==========
const char* ssid = "HCSS";          // ä½ çš„ WiFi åç§°
const char* password = "123456789"; // ä½ çš„ WiFi å¯†ç 
const char* serverUrl = "http://192.168.137.1:3000/upload"; // ä½ çš„æœåŠ¡å™¨åœ°å€

// ========== 2) NTP é…ç½® ==========
const char* ntpServer = "pool.ntp.org"; // NTP æœåŠ¡å™¨
const long gmtOffset_sec = 8 * 3600;      // UTC+8 (ä¸­å›½)
const int daylightOffset_sec = 0;         // æ— å¤ä»¤æ—¶

// ========== 3) OLED å±å¹•é…ç½® ==========
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET   -1
#define SCREEN_ADDRESS 0x3C

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

void setupDisplay() {
  if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
    Serial.println(F("OLED æ˜¾ç¤ºåˆå§‹åŒ–å¤±è´¥!"));
    for (;;);
  }
  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);
  display.display();
}

// ========== 4) ä¸²å£å®šä¹‰ ==========
#define ARDUINO_RX_PIN 4   // Arduino TX -> ESP32 GPIO4
#define ARDUINO_TX_PIN 17  // Arduino RX -> ESP32 GPIO17
#define SDS011_RX_PIN 25   // SDS011 TX -> ESP32 GPIO25
#define SDS011_TX_PIN 26   // SDS011 RX -> ESP32 GPIO26

// ========== 5) å…¨å±€å˜é‡ ==========
int arduinoValues[5] = {0, 0, 0, 0, 0}; // åŸå§‹æ•°æ®ï¼šMQ-2, CO, NO2, NH3, CO2
float pm25 = 0.0, pm10 = 0.0;           // SDS011 æ•°æ®

// æ·»åŠ é¡µé¢æ§åˆ¶å˜é‡ï¼š0 è¡¨ç¤ºæ˜¾ç¤º Arduino æ•°æ®ï¼ˆç»è¿‡è°ƒæ•´ï¼‰ï¼Œ1 è¡¨ç¤ºæ˜¾ç¤º SDS011 æ•°æ®
int currentPage = 0;

// ========== 6) å®šæ—¶å™¨ ==========
unsigned long previousDataTime = 0;
const unsigned long dataInterval = 10000; // æ¯ 10 ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®
unsigned long previousPageTime = 0;
const unsigned long pageInterval = 5000;  // æ¯ 5 ç§’åˆ‡æ¢ä¸€æ¬¡æ˜¾ç¤ºé¡µé¢

// ========== 7) OLED æ˜¾ç¤ºå‡½æ•° ==========
// æ˜¾ç¤º Arduino æ•°æ®ï¼ˆè°ƒæ•´åæ•°æ®ï¼Œä¸å‰ç«¯ä¸€è‡´ï¼‰ï¼š
void displayArduinoData() {
  // è®¡ç®—è°ƒæ•´åçš„æ•°æ®
  float coAdjusted  = arduinoValues[1] * 0.1; // CO: åŸå§‹å€¼Ã—0.1, å•ä½ ppm
  float no2Adjusted = arduinoValues[2] * 0.1; // NO2: åŸå§‹å€¼Ã—0.1, å•ä½ ppb
  float co2Adjusted = arduinoValues[4] / 2.0; // CO2: åŸå§‹å€¼Ã·2, å•ä½ ppm

  display.clearDisplay();

  // ç¬¬1è¡Œï¼šCombustible Gas (MQ-2)
  display.setCursor(0, 0);
  display.print("Gas: ");
  display.print(arduinoValues[0]);
  display.print(" ppm");

  // ç¬¬2è¡Œï¼šCO
  display.setCursor(0, 8);
  display.print("CO: ");
  display.print(coAdjusted, 1);
  display.print(" ppm");

  // ç¬¬3è¡Œï¼šNO2
  display.setCursor(0, 16);
  display.print("NO2: ");
  display.print(no2Adjusted, 1);
  display.print(" ppb");

  // ç¬¬4è¡Œï¼šNH3 (ä¿æŒåŸå€¼ï¼Œå•ä½ ppb)
  display.setCursor(0, 24);
  display.print("NH3: ");
  display.print(arduinoValues[3]);
  display.print(" ppb");

  // ç¬¬5è¡Œï¼šCO2
  display.setCursor(0, 32);
  display.print("CO2: ");
  display.print(co2Adjusted, 1);
  display.print(" ppm");

  display.display();
}

// æ˜¾ç¤º SDS011 æ•°æ®ï¼ˆä»… PM2.5 ä¸ PM10ï¼‰
void displaySDS011Data() {
  display.clearDisplay();

  display.setCursor(0, 0);
  display.print("PM2.5: ");
  display.print(pm25 + 10, 1);
  display.print(" ug/m3");

  display.setCursor(0, 8);
  display.print("PM10: ");
  display.print(pm10 + 10, 1);
  display.print(" ug/m3");

  display.display();
}

// æ ¹æ® currentPage åˆ‡æ¢æ˜¾ç¤ºå†…å®¹
void updateDisplay() {
  if (currentPage == 0) {
    displayArduinoData();
  } else {
    displaySDS011Data();
  }
}

// ========== 8) SDS011 ä¼ æ„Ÿå™¨å¯¹è±¡ ==========
HardwareSerial sdsSerial(1);
SdsDustSensor sds011(sdsSerial);

// ========== 9) WiFi æ•°æ®ä¸Šä¼ å‡½æ•° ==========
void sendToServer() {
  // æ„é€  JSON æ•°æ®ï¼Œé‡‡ç”¨ä¸å‰ç«¯ä¸€è‡´çš„è°ƒæ•´
  String jsonData = "{";
  jsonData += "\"mq2\":"  + String(arduinoValues[0]) + ",";
  jsonData += "\"co\":"   + String(arduinoValues[1] * 0.1) + ",";
  jsonData += "\"no2\":"  + String(arduinoValues[2] * 0.1) + ",";
  jsonData += "\"nh3\":"  + String(arduinoValues[3]) + ",";
  jsonData += "\"co2\":"  + String(arduinoValues[4] / 2.0) + ",";
  jsonData += "\"pm25\":" + String(pm25 + 10 , 1) + ",";
  jsonData += "\"pm10\":" + String(pm10 + 10 , 1);
  jsonData += "}";

  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;
    http.begin(serverUrl);
    http.addHeader("Content-Type", "application/json");

    Serial.print("Sending JSON: ");
    Serial.println(jsonData);

    int httpResponseCode = http.POST(jsonData);
    Serial.print("HTTP Response Code: ");
    Serial.println(httpResponseCode);

    http.end();
  } else {
    Serial.println("WiFi not connected!");
  }
}

// ========== 10) SD å¡é…ç½® ==========
#define SD_CS_PIN 5
bool sdInitialized = false;

// ========== 11) èœ‚é¸£å™¨é…ç½® ==========
#define BUZZER_PIN 16  // èœ‚é¸£å™¨è¿æ¥åˆ° GPIO16

// è®¾ç½®æŠ¥è­¦é˜ˆå€¼ï¼ˆå•ä½åŸºäºåŸå§‹æ•°æ®ï¼‰
const int THRESHOLD_MQ2    = 600;
const int THRESHOLD_CO     = 1000;
const int THRESHOLD_NO2    = 1500;
const int THRESHOLD_NH3    = 1200;
const int THRESHOLD_CO2    = 2000;
const float THRESHOLD_PM25 = 25.0;
const float THRESHOLD_PM10 = 50.0;

bool needAlarm = false;

// ========== 12) NTP æ—¶é—´åŒæ­¥ ==========
void setupTime() {
  configTime(gmtOffset_sec, daylightOffset_sec, ntpServer);
  Serial.print("Syncing time");
  while (true) {
    time_t now = time(nullptr);
    if (now > 8 * 3600) {  // åˆ¤æ–­æ˜¯å¦åŒæ­¥æˆåŠŸ
      Serial.println("\nTime sync OK!");
      break;
    }
    Serial.print(".");
    delay(1000);
  }
}

// ========== 13) SD å¡å†™å…¥å‡½æ•° ==========
void writeDataToSD() {
  if (!sdInitialized) return;

  File file = SD.open("/sensor_data.csv", FILE_APPEND);
  if (!file) {
    Serial.println("Failed to open sensor_data.csv for writing!");
    return;
  }

  if (file.size() == 0) {
    file.println("MQ2,CO,NO2,NH3,CO2,PM2.5,PM10,Time");
  }

  time_t now = time(nullptr);
  struct tm* timeinfo = localtime(&now);
  char timeString[25];
  strftime(timeString, sizeof(timeString), "%F %T", timeinfo);

  file.print(arduinoValues[0]); file.print(",");
  file.print(arduinoValues[1] * 0.1); file.print(",");
  file.print(arduinoValues[2] * 0.1); file.print(",");
  file.print(arduinoValues[3]); file.print(",");
  file.print(arduinoValues[4] / 2.0); file.print(",");
  file.print(pm25 + 10, 1);          file.print(",");
  file.print(pm10 + 10, 1);          file.print(",");
  file.println(timeString);

  file.close();
  Serial.println("Data saved to sensor_data.csv");
}

// ========== 14) setup() å‡½æ•° ==========
void setup() {
  Serial.begin(115200);
  Serial.println("===== ESP32: Starting =====");

  // åˆå§‹åŒ– OLED æ˜¾ç¤ºå™¨
  setupDisplay();

  // è¿æ¥ WiFi
  Serial.print("Connecting WiFi: ");
  Serial.println(ssid);
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nWiFi Connected!");
  Serial.print("IP: ");
  Serial.println(WiFi.localIP());

  // åŒæ­¥ NTP æ—¶é—´
  setupTime();

  // åˆå§‹åŒ–ä¸²å£
  Serial2.begin(115200, SERIAL_8N1, ARDUINO_RX_PIN, ARDUINO_TX_PIN);
  Serial.println("Serial2 (Arduino) ready.");
  sdsSerial.begin(9600, SERIAL_8N1, SDS011_RX_PIN, SDS011_TX_PIN);
  Serial.println("SDS011 ready.");

  // SDS011 ä¸»åŠ¨æ¨¡å¼
  sds011.setActiveReportingMode();

  previousDataTime = millis();
  previousPageTime = millis();

  // åˆå§‹åŒ–èœ‚é¸£å™¨å¼•è„š
  pinMode(BUZZER_PIN, OUTPUT);

  // åˆå§‹åŒ– SD å¡
  Serial.println("Init SD...");
  if (!SD.begin(SD_CS_PIN)) {
    Serial.println("SD failed, no file logging!");
    sdInitialized = false;
  } else {
    Serial.println("SD OK.");
    sdInitialized = true;
  }

  // åˆæ¬¡æ˜¾ç¤º
  updateDisplay();
}

// ========== 15) loop() å‡½æ•° ==========
void loop() {
  unsigned long currentMillis = millis();

  // æ¯ 10 ç§’åˆ·æ–°æ•°æ®
  if (currentMillis - previousDataTime >= dataInterval) {
    previousDataTime = currentMillis;

    // 1) è¯»å– SDS011 æ•°æ®ï¼ˆPM2.5 å’Œ PM10ï¼‰
    PmResult pm = sds011.queryPm();
    if (pm.isOk()) {
      pm25 = pm.pm25;
      pm10 = pm.pm10;
      Serial.printf("SDS011: PM2.5=%.1f, PM10=%.1f\n", pm25, pm10);
    } else {
      Serial.println("SDS011 read failed.");
    }

    // 2) è¯»å– Arduino æ•°æ®ï¼ˆä» Serial2 è·å–ï¼‰
    if (Serial2.available()) {
      String data = Serial2.readStringUntil('\n');
      Serial.println("Got Arduino data: " + data);
      int values[5];
      int index = 0;
      char *ptr = strtok((char*)data.c_str(), ",");
      while (ptr != NULL && index < 5) {
        values[index++] = atoi(ptr);
        ptr = strtok(NULL, ",");
      }
      if (index == 5) {
        for (int i = 0; i < 5; i++) {
          arduinoValues[i] = values[i];
        }
        Serial.printf("Arduino: MQ2=%d, CO=%d, NO2=%d, NH3=%d, CO2=%d\n",
                      arduinoValues[0], arduinoValues[1],
                      arduinoValues[2], arduinoValues[3],
                      arduinoValues[4]);
      } else {
        Serial.println("Arduino data parse error!");
      }
    } else {
      Serial.println("No Arduino data.");
    }

    // 3) æ›´æ–° OLED æ˜¾ç¤ºï¼ˆæ ¹æ®å½“å‰é¡µé¢æ˜¾ç¤ºç›¸åº”æ•°æ®ï¼‰
    updateDisplay();

    // é¡µé¢åˆ‡æ¢ï¼šæ¯ 5 ç§’åˆ‡æ¢ä¸€æ¬¡æ˜¾ç¤ºé¡µé¢
    if (currentMillis - previousPageTime >= pageInterval) {
      previousPageTime = currentMillis;
      currentPage = (currentPage + 1) % 2;
      updateDisplay();
    }

    // 4) ä¸Šä¼ æ•°æ®åˆ°æœåŠ¡å™¨
    sendToServer();

    // 5) å†™å…¥ SD å¡ï¼ˆé™„åŠ æ—¶é—´æˆ³ï¼‰
    writeDataToSD();

    // 6) åˆ¤æ–­æ˜¯å¦è¶…å‡ºé˜ˆå€¼ï¼Œå¹¶è§¦å‘èœ‚é¸£å™¨ï¼ˆæŠ¥è­¦åˆ¤æ–­åŸºäºåŸå§‹æ•°æ®ï¼‰
    needAlarm = false;
    if (arduinoValues[0] > THRESHOLD_MQ2) needAlarm = true; // MQ2
    if (arduinoValues[1] > THRESHOLD_CO)  needAlarm = true; // CO
    if (arduinoValues[2] > THRESHOLD_NO2) needAlarm = true; // NO2
    if (arduinoValues[3] > THRESHOLD_NH3) needAlarm = true; // NH3
    if (arduinoValues[4] > THRESHOLD_CO2) needAlarm = true; // CO2
    if (pm25 > THRESHOLD_PM25)            needAlarm = true; // PM2.5
    if (pm10 > THRESHOLD_PM10)            needAlarm = true; // PM10

    if (needAlarm) {
      Serial.println("Sensor values exceed thresholds, triggering alarm beep!");
      tone(BUZZER_PIN, 4000, 300);
    } else {
      noTone(BUZZER_PIN);
      Serial.println("Values normal, no alarm.");
    }
  }

  delay(100);
}
